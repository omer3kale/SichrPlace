<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Apartments Listing - SichrPlace</title>
  
  <!-- Favicon and Icons -->
  <link rel="icon" href="img/favicon.ico" sizes="any">
  <link rel="icon" href="img/favicon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="img/apple-touch-icon.png">
  <link rel="icon" href="img/favicon-96x96.png" sizes="96x96" type="image/png">
  <link rel="icon" href="img/web-app-manifest-192x192.png" sizes="192x192" type="image/png">
  <link rel="icon" href="img/web-app-manifest-512x512.png" sizes="512x512" type="image/png">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Roboto:wght@300;400;500&display=swap">
  <link rel="stylesheet" href="css/logo-system.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  
  <!-- 🔥 BULLETPROOF PAYPAL INTEGRATION -->
  <script src="js/bulletproof-paypal-integration.js"></script>
  
  <style>
    :root {
      --primary: #2563EB;
      --secondary: #F9FAFB;
      --accent: #40E0D0;
      --text: #222;
      --muted: #6b7280;
      --card: #fff;
      --radius: 18px;
      --shadow: 0 2px 12px rgba(0,0,0,0.06);
      --heading-font: "Poppins", sans-serif;
      --body-font: "Roboto", sans-serif;
    }
    body {
      margin: 0;
      font-family: var(--body-font);
      background: var(--secondary);
      color: var(--text);
    }
    header {
      background: var(--card);
      box-shadow: var(--shadow);
      padding: 0 40px;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .header-logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .brand-text {
      display: flex;
      flex-direction: column;
    }
    .sichrplace-text {
      font-family: var(--heading-font);
      font-weight: 700;
      font-size: 1.4rem;
      color: var(--primary);
      line-height: 1;
    }
    .certified-badge {
      font-size: 0.8rem;
      color: var(--accent);
      font-weight: 600;
      margin-top: 2px;
    }
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-family: var(--heading-font);
      font-weight: 600;
      font-size: 1.5rem;
      color: var(--primary);
      text-decoration: none;
    }
    .logo img {
      height: 40px;
    }
    nav {
      display: flex;
      gap: 24px;
    }
    nav a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 600;
      font-family: var(--heading-font);
      font-size: 1rem;
      transition: color 0.2s;
    }
    nav a:hover {
      color: var(--accent);
    }

    .page-title {
      font-family: var(--heading-font);
      font-size: 2.2rem;
      font-weight: 700;
      color: var(--primary);
      margin: 40px 0 20px 0;
      text-align: center;
      letter-spacing: -1px;
    }

    .filters-bar {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 18px;
      margin-bottom: 32px;
      margin-top: 10px;
    }
    .filters-bar button {
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: var(--radius);
      padding: 10px 28px;
      font-family: var(--heading-font);
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: var(--shadow);
      transition: background 0.2s;
    }
    .filters-bar button:hover {
      background: #2BC4B6;
    }

    .filters-container {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.2);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    .filters-container.active {
      display: flex;
    }
    .filters-modal {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 32px 28px;
      width: 90vw;
      max-width: 600px;
      position: relative;
    }
    .filters-header {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 20px;
      position: relative;
    }
    .filters-header h2 {
      margin: 0;
      font-size: 20px;
      color: var(--primary);
      font-family: var(--heading-font);
    }
    .close-filters {
      background: none;
      border: none;
      color: #F87171;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      right: 0;
    }
    .close-filters:hover {
      color: #E11D48;
    }
    .filters-row {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 12px;
    }
    .filter-group {
      flex: 1;
      min-width: 200px;
    }
    .filters-modal label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: var(--primary);
      font-family: var(--heading-font);
    }
    .filters-modal input, .filters-modal select {
      width: 100%;
      padding: 10px;
      border: 1px solid #d1d5db;
      border-radius: var(--radius);
      font-family: var(--body-font);
      font-size: 1rem;
      margin-bottom: 10px;
    }
    .filters-modal button.apply-filters {
      margin-top: 15px;
      padding: 10px;
      background-color: #10B981;
      color: white;
      border: none;
      border-radius: var(--radius);
      cursor: pointer;
      font-family: var(--heading-font);
      font-weight: 600;
      font-size: 1rem;
      width: 100%;
      box-shadow: var(--shadow);
    }
    .filters-modal button.apply-filters:hover {
      background-color: #059669;
    }

    .listings {
      max-width: 1200px;
      margin: 0 auto 60px auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 24px;
      padding: 0 20px;
    }
    
    .listing {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      text-decoration: none;
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    
    .listing:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    .listing-image {
      width: 100%;
      height: 240px;
      background-size: cover;
      background-position: center;
      position: relative;
    }
    
    .listing-image::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(180deg, transparent 0%, rgba(0,0,0,0.1) 100%);
    }
    
    .listing-details {
      padding: 20px;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .listing-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--primary);
      margin: 0;
      font-family: var(--heading-font);
      line-height: 1.3;
    }
    
    .listing-location {
      color: var(--muted);
      font-size: 0.95rem;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .listing-price {
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--accent);
      margin: 8px 0;
      font-family: var(--heading-font);
    }
    
    .listing-features {
      display: flex;
      gap: 16px;
      margin: 8px 0;
      flex-wrap: wrap;
    }
    
    .listing-feature {
      display: flex;
      align-items: center;
      gap: 4px;
      color: var(--muted);
      font-size: 0.9rem;
    }
    
    .listing-tags {
      display: flex;
      gap: 8px;
      margin: 12px 0;
      flex-wrap: wrap;
    }
    
    .property-tag {
      background: #f3f4f6;
      color: var(--text);
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 500;
    }
    
    .property-tag.pet-friendly {
      background: #dcfce7;
      color: #166534;
    }
    
    .property-tag.no-pets {
      background: #fef2f2;
      color: #991b1b;
    }
    
    .property-tag.furnished {
      background: #dbeafe;
      color: #1e40af;
    }
    
    .listing-actions {
      margin-top: auto;
      padding-top: 12px;
      border-top: 1px solid #f3f4f6;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .view-details-btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    
    .view-details-btn:hover {
      background: var(--primary-dark);
    }
    .favorite-button {
      padding: 10px 18px;
      background-color: #10B981;
      color: white;
      border: none;
      border-radius: var(--radius);
      cursor: pointer;
      font-family: var(--heading-font);
      font-weight: 600;
      font-size: 1rem;
      align-self: flex-start;
      transition: background 0.2s;
      box-shadow: var(--shadow);
    }
    .favorite-button:hover {
      background-color: #059669;
    }

    /* Responsive */
    @media (max-width: 900px) {
      .listings {
        gap: 18px;
      }
      .listing {
        flex-direction: column;
        gap: 12px;
        padding: 18px 8px;
      }
      .listing-image {
        width: 100%;
        height: 180px;
      }
    }

    /* =============================================
       🎨 ENHANCED PROPERTY TAGS & AMENITIES
       ============================================= */
    .property-tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      text-transform: capitalize;
      border: 1px solid;
    }

    .property-tag.pet-friendly {
      background: #e8f5e8;
      color: #2d5a2d;
      border-color: #4caf50;
    }

    .property-tag.no-pets {
      background: #ffebee;
      color: #c62828;
      border-color: #f44336;
    }

    .property-tag.pets-conditional {
      background: #fff3e0;
      color: #ef6c00;
      border-color: #ff9800;
    }

    .property-tag.furnished {
      background: #e3f2fd;
      color: #1565c0;
      border-color: #2196f3;
    }

    .property-tag.parking {
      background: #f3e5f5;
      color: #6a1b9a;
      border-color: #9c27b0;
    }

    /* Map container styling */
    #map-container {
      display: none;
      width: 100%;
      height: 400px;
      background: #f8f9fa;
      border: 2px dashed #dee2e6;
      border-radius: 8px;
      margin: 20px 0;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #6c757d;
      font-size: 16px;
      font-weight: 500;
    }

    #map-container.visible {
      display: flex;
    }

    /* Advanced Search Toggle Styles */
    #advanced-filters {
      overflow: hidden;
      transition: max-height 0.3s ease-in-out, opacity 0.3s ease-in-out;
      max-height: 0;
      opacity: 0;
    }

    #advanced-filters.visible {
      max-height: 1000px;
      opacity: 1;
    }

    #advanced-search-toggle {
      transition: background-color 0.3s ease;
    }

    /* Language Switcher Styles */
    .language-switcher {
      position: relative;
      display: inline-block;
    }
    
    .language-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      background: var(--primary);
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-family: var(--heading-font);
      font-weight: 600;
      font-size: 0.9rem;
      transition: all 0.2s ease;
      outline: none;
    }
    
    .language-btn:hover {
      background: #1d4ed8;
      transform: translateY(-1px);
    }
    
    .language-btn i:last-child {
      font-size: 0.7rem;
      transition: transform 0.2s ease;
    }
    
    .language-btn.active i:last-child {
      transform: rotate(180deg);
    }
    
    .language-dropdown {
      display: none;
      position: absolute;
      top: 100%;
      right: 0;
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      min-width: 140px;
      z-index: 1000;
      overflow: hidden;
      margin-top: 8px;
      border: 1px solid #e1e5e9;
    }
    
    .language-dropdown.active {
      display: block;
      animation: fadeInDown 0.2s ease-out;
    }
    
    .lang-option {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      color: var(--text);
      text-decoration: none;
      font-family: var(--body-font);
      font-weight: 500;
      font-size: 0.9rem;
      transition: background 0.2s ease;
      border-bottom: 1px solid #f1f1f1;
    }
    
    .lang-option:last-child {
      border-bottom: none;
    }
    
    .lang-option:hover {
      background: var(--secondary);
    }
    
    .lang-option.active {
      background: var(--primary);
      color: white;
    }
    
    .flag-emoji {
      font-size: 16px;
      line-height: 1;
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
  <script src="js/translation-handler.js" defer></script>
    <script src="js/logo-cookie-manager.js" defer></script>
</head>
<body>
  <header>
    <div class="header-logo">
      <a href="index.html" class="logo" aria-label="SichrPlace">
        <img src="img/sichrplace-logo.jpg" alt="SichrPlace logo" style="height:48px;width:auto;display:block;">
        <span class="brand-text">
          <span class="sichrplace-text">SichrPlace</span>
          <span class="certified-badge" style="display:none;">Verified</span>
        </span>
      </a>
    </div>
    <button class="menu-toggle" id="menu-toggle" aria-label="Toggle navigation" aria-expanded="false">
      <span class="menu-bar"></span>
      <span class="menu-bar"></span>
      <span class="menu-bar"></span>
    </button>
    <nav class="main-nav" id="main-nav">
      <a href="login.html" data-translate="nav.login">Login</a>
      <a href="apartments-listing.html" data-translate="nav.apartments">Apartments</a>
      
      <!-- View link for viewing requests -->
      <a href="viewing-request.html" data-translate="nav.view">View</a>
      
      <!-- Marketplace Cart Icon - Enhanced Visibility -->
      <a href="marketplace.html" class="cart-icon" title="Marketplace - Buy & Sell" aria-label="Marketplace" data-translate-title="nav.marketplace.title" data-translate-aria="nav.marketplace.aria">
        <svg class="cart-icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path d="M7.01 18.5a1.5 1.5 0 1 1-2.999.001 1.5 1.5 0 0 1 2.999-.001Zm10 0a1.5 1.5 0 1 1-3.001 0 1.5 1.5 0 0 1 3.001 0ZM6.16 7l.44 2h11.56a1 1 0 0 1 .98 1.204l-1.2 6a1 1 0 0 1-.98.796H8.18a1 1 0 0 1-.98-.804L5.53 4.5H3a1 1 0 1 1 0-2h3a1 1 0 0 1 .98.804L7.62 7H6.16Z" fill="currentColor" />
        </svg>
        <span class="cart-label" data-translate="nav.marketplace.label">Marketplace</span>
      </a>
      
      <!-- Language Switcher moved to the rightmost position -->
      <div class="language-switcher">
        <button class="language-btn" id="language-btn" aria-label="Switch Language">
          <i class="fas fa-globe"></i>
          <span id="current-lang">EN</span>
          <i class="fas fa-chevron-down"></i>
        </button>
        <div class="language-dropdown" id="language-dropdown">
          <a href="#" data-lang="en" class="lang-option active">
            <span class="flag-emoji">🇺🇸</span>
            English
          </a>
          <a href="#" data-lang="de" class="lang-option">
            <span class="flag-emoji">🇩🇪</span>
            Deutsch
          </a>
          <a href="#" data-lang="tr" class="lang-option">
            <span class="flag-emoji">🇹🇷</span>
            Türkçe
          </a>
        </div>
      </div>
    </nav>
  </header>

  <div class="page-title">🏠 Available Apartments</div>
  
  <!-- Enhanced Search and Filters -->
  <div style="max-width: 1200px; margin: 0 auto 32px auto; padding: 0 20px;">
    <div style="background: white; padding: 24px; border-radius: 18px; box-shadow: var(--shadow); margin-bottom: 20px;">
      
      <!-- Main Search Row -->
      <div style="display: flex; gap: 16px; flex-wrap: wrap; align-items: center; margin-bottom: 20px;">
        <!-- Search Input -->
        <div style="flex: 1; min-width: 280px;">
          <input type="text" id="search-input" placeholder="Search by location, address, or keywords..." style="
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s;
          " oninput="handleSearch()" onkeyup="if(event.key==='Enter') handleSearch()">
        </div>
        
        <!-- Filters Button -->
        <div class="filters-bar">
          <button onclick="toggleFilters()" style="display: inline-flex; align-items: center; gap: 8px; padding: 12px 20px; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s; white-space: nowrap;">
            <i class="fa fa-filter"></i> Filters
          </button>
        </div>

        <!-- Map View Toggle -->
        <div>
          <button id="map-toggle" onclick="showMapView()" 
                  onmouseover="this.style.background='var(--primary)'; this.style.color='white'" 
                  onmouseout="this.style.background='var(--secondary)'; this.style.color='var(--primary)'"
                  style="display: inline-flex; align-items: center; gap: 8px; padding: 12px 20px; background: var(--secondary); color: var(--primary); border: 2px solid var(--primary); border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s; white-space: nowrap;">
            <i class="fas fa-map-marked-alt"></i>
            <span id="map-toggle-text">Map View</span>
          </button>
        </div>
        
        <!-- Inspection Icon -->
        <div>
          <button onclick="handleSearch()" 
                  onmouseover="this.style.background='var(--accent)'; this.style.color='white'" 
                  onmouseout="this.style.background='var(--secondary)'; this.style.color='var(--accent)'"
                  style="display: inline-flex; align-items: center; justify-content: center; width: 48px; height: 48px; background: var(--secondary); color: var(--accent); border: 2px solid var(--accent); border-radius: 8px; cursor: pointer; transition: all 0.2s;" title="Search Apartments">
            <i class="fas fa-search" style="font-size: 18px;"></i>
          </button>
        </div>
      </div>

      <!-- Unified Display Container -->
      <div id="display-container" style="display: none; background: white; border-radius: 18px; box-shadow: var(--shadow); overflow: hidden; margin-bottom: 20px; position: relative; max-height: 0; transition: max-height 0.3s ease-in-out;">

        <!-- Map View Content -->
        <div id="map-view-content" style="display: none; position: relative;">
          <!-- Map Close Button -->
          <button onclick="hideDisplayContainer()" style="
            position: absolute;
            top: 15px;
            right: 15px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            z-index: 10;
            transition: background 0.2s;
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
          " onmouseover="this.style.background='#c82333'" onmouseout="this.style.background='#dc3545'" title="Close Map">
            <i class="fa fa-times"></i>
          </button>
          
          <div style="height: 450px; background: #f0f2f5; display: flex; align-items: center; justify-content: center; color: var(--muted);">
            <div style="text-align: center;">
              <i class="fas fa-map" style="font-size: 48px; color: var(--primary); margin-bottom: 16px;"></i>
              <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">Interactive Map View</div>
              <div style="font-size: 14px;">Google Maps integration will display apartment locations here</div>
            </div>
          </div>
        </div>

        <!-- Advanced Search Content -->
        <div id="advanced-search-content" style="display: none; padding: 30px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #e1e5e9; padding-bottom: 15px;">
            <h3 style="margin: 0; color: var(--primary); font-family: var(--heading-font); font-size: 1.4rem;">
              <i class="fas fa-search-plus" style="color: var(--accent); margin-right: 8px;"></i>
              Essential Filters
            </h3>
            <!-- Close Button for Advanced Search -->
            <button onclick="hideDisplayContainer()" style="
              background: #dc3545;
              color: white;
              border: none;
              border-radius: 50%;
              padding: 8px;
              cursor: pointer;
              display: flex;
              align-items: center;
              justify-content: center;
              font-size: 14px;
              font-weight: 600;
              transition: background 0.2s;
              box-shadow: 0 2px 4px rgba(0,0,0,0.1);
              width: 32px;
              height: 32px;
            " onmouseover="this.style.background='#c82333'" onmouseout="this.style.background='#dc3545'" title="Close Advanced Search">
              <i class="fa fa-times"></i>
            </button>
          </div>
          
          <!-- Simplified Filters Grid -->
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; max-width: 800px; margin: 0 auto;">
            <!-- Bedrooms -->
            <div>
              <label style="font-weight: 600; color: var(--text); display: block; margin-bottom: 8px;">
                <i class="fas fa-bed" style="color: var(--accent);"></i> Bedrooms
              </label>
              <select style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 14px; background: white;">
                <option value="">Any</option>
                <option value="1">1 Bedroom</option>
                <option value="2">2 Bedrooms</option>
                <option value="3">3 Bedrooms</option>
                <option value="4">4+ Bedrooms</option>
              </select>
            </div>
            
            <!-- Price Range -->
            <div>
              <label style="font-weight: 600; color: var(--text); display: block; margin-bottom: 8px;">
                <i class="fas fa-euro-sign" style="color: var(--accent);"></i> Monthly Rent
              </label>
              <select style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 14px; background: white;">
                <option value="">Any Price</option>
                <option value="0-500">Up to €500</option>
                <option value="500-800">€500 - €800</option>
                <option value="800-1200">€800 - €1,200</option>
                <option value="1200-1600">€1,200 - €1,600</option>
                <option value="1600-2000">€1,600 - €2,000</option>
                <option value="2000+">€2,000+</option>
              </select>
            </div>
            
            <!-- Property Type -->
            <div>
              <label style="font-weight: 600; color: var(--text); display: block; margin-bottom: 8px;">
                <i class="fas fa-home" style="color: var(--accent);"></i> Property Type
              </label>
              <select style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 14px; background: white;">
                <option value="">All Types</option>
                <option value="apartment">Apartment</option>
                <option value="studio">Studio</option>
                <option value="house">House</option>
              </select>
            </div>
            
            <!-- Furnished Status -->
            <div>
              <label style="font-weight: 600; color: var(--text); display: block; margin-bottom: 8px;">
                <i class="fas fa-couch" style="color: var(--accent);"></i> Furnished
              </label>
              <select style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 14px; background: white;">
                <option value="">Any</option>
                <option value="furnished">Furnished</option>
                <option value="unfurnished">Unfurnished</option>
              </select>
            </div>
          </div>
          
          <!-- Action Buttons -->
          <div style="margin-top: 25px; display: flex; gap: 12px; justify-content: center; border-top: 1px solid #e1e5e9; padding-top: 20px;">
            <button onclick="applyAdvancedFilters()" style="background: var(--primary); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='#1d4ed8'" onmouseout="this.style.background='var(--primary)'">
              <i class="fas fa-search"></i> Find Apartments
            </button>
            <button onclick="clearAdvancedFilters()" style="background: var(--muted); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='#374151'" onmouseout="this.style.background='var(--muted)'">
              <i class="fas fa-eraser"></i> Clear All
            </button>
          </div>
          
          <!-- Simplified Note -->
          <div style="text-align: center; margin-top: 15px; padding: 12px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid var(--accent);">
            <small style="color: var(--muted); font-style: italic;">
              <i class="fas fa-lightbulb" style="color: var(--accent);"></i> 
              Simplified search for faster results. Use the main search box above for location-based searches.
            </small>
          </div>
      </div>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h3 style="margin: 0; color: var(--text); font-size: 18px; font-weight: 600;">
            <i class="fas fa-filter" style="color: var(--primary); margin-right: 8px;"></i>
            Advanced Filters
          </h3>
          <div style="display: flex; gap: 8px;">
            <button onclick="clearAllFilters()" style="
              background: rgb(108, 117, 125);
              color: white;
              border: none;
              padding: 10px 16px;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 600;
              cursor: pointer;
              transition: background 0.2s;
            " onmouseover="this.style.background='#5a6268'" onmouseout="this.style.background='#6c757d'">
              <i class="fa fa-times"></i> Clear
            </button>
          </div>
        </div>

        <!-- Filters Grid -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px;">
        
        <!-- Price Range Slider -->
        <div style="min-width: 200px;">
          <label style="font-weight: 600; color: var(--text); display: block; margin-bottom: 8px;">
            <i class="fas fa-euro-sign" style="color: var(--primary);"></i> Price Range
          </label>
          <div style="display: flex; gap: 8px; align-items: center; margin-bottom: 8px;">
            <input type="number" id="min-price" placeholder="Min €" style="
              width: 80px; padding: 6px 8px; border: 1px solid #e1e5e9; border-radius: 6px; font-size: 14px;
            " oninput="handlePriceFilter()">
            <span style="color: var(--muted);">-</span>
            <input type="number" id="max-price" placeholder="Max €" style="
              width: 80px; padding: 6px 8px; border: 1px solid #e1e5e9; border-radius: 6px; font-size: 14px;
            " oninput="handlePriceFilter()">
          </div>
          <div style="position: relative;">
            <input type="range" id="price-range" min="200" max="2000" value="1000" style="
              width: 100%; height: 6px; border-radius: 3px; background: #e1e5e9; outline: none;
              -webkit-appearance: none; appearance: none; cursor: pointer;
            " oninput="updatePriceSlider()">
            <div id="price-display" style="font-size: 12px; color: var(--muted); text-align: center; margin-top: 4px;">
              €200 - €2000
            </div>
          </div>
        </div>

        <!-- Room Count -->
        <div>
          <label style="font-weight: 600; color: var(--text); display: block; margin-bottom: 8px;">
            <i class="fas fa-bed" style="color: var(--primary);"></i> Bedrooms
          </label>
          <select id="bedrooms-filter" style="
            width: 100%; padding: 8px 12px; border: 1px solid #e1e5e9; border-radius: 6px; font-size: 14px;
          " onchange="applyFilters()">
            <option value="">Any</option>
            <option value="1">1 Bedroom</option>
            <option value="2">2 Bedrooms</option>
            <option value="3">3 Bedrooms</option>
            <option value="4">4+ Bedrooms</option>
          </select>
        </div>

        <!-- Bathrooms -->
        <div>
          <label style="font-weight: 600; color: var(--text); display: block; margin-bottom: 8px;">
            <i class="fas fa-bath" style="color: var(--primary);"></i> Bathrooms
          </label>
          <select id="bathrooms-filter" style="
            width: 100%; padding: 8px 12px; border: 1px solid #e1e5e9; border-radius: 6px; font-size: 14px;
          " onchange="applyFilters()">
            <option value="">Any</option>
            <option value="1">1 Bathroom</option>
            <option value="2">2 Bathrooms</option>
            <option value="3">3+ Bathrooms</option>
          </select>
        </div>

        <!-- Pet-Friendly -->
        <div>
          <label style="font-weight: 600; color: var(--text); display: block; margin-bottom: 8px;">
            <i class="fas fa-paw" style="color: var(--primary);"></i> Pet Policy
          </label>
          <select id="pet-filter" style="
            width: 100%; padding: 8px 12px; border: 1px solid #e1e5e9; border-radius: 6px; font-size: 14px;
          " onchange="applyFilters()">
            <option value="">Any</option>
            <option value="pet-friendly">Pet-Friendly</option>
            <option value="no-pets">No Pets</option>
            <option value="cats-only">Cats Only</option>
            <option value="dogs-only">Dogs Only</option>
          </select>
        </div>

        <!-- Furnished Status -->
        <div>
          <label style="font-weight: 600; color: var(--text); display: block; margin-bottom: 8px;">
            <i class="fas fa-couch" style="color: var(--primary);"></i> Furnished
          </label>
          <select id="furnished-filter" style="
            width: 100%; padding: 8px 12px; border: 1px solid #e1e5e9; border-radius: 6px; font-size: 14px;
          " onchange="applyFilters()">
            <option value="">Any</option>
            <option value="furnished">Furnished</option>
            <option value="unfurnished">Unfurnished</option>
            <option value="semi-furnished">Semi-Furnished</option>
          </select>
        </div>

        <!-- Parking -->
        <div>
          <label style="font-weight: 600; color: var(--text); display: block; margin-bottom: 8px;">
            <i class="fas fa-car" style="color: var(--primary);"></i> Parking
          </label>
          <select id="parking-filter" style="
            width: 100%; padding: 8px 12px; border: 1px solid #e1e5e9; border-radius: 6px; font-size: 14px;
          " onchange="applyFilters()">
            <option value="">Any</option>
            <option value="included">Parking Included</option>
            <option value="garage">Garage</option>
            <option value="street">Street Parking</option>
            <option value="none">No Parking</option>
          </select>
        </div>
      </div>

      <!-- Premium Amenities (Checkboxes) -->
      <div style="border-top: 1px solid #e1e5e9; padding-top: 20px;">
        <label style="font-weight: 600; color: var(--text); display: block; margin-bottom: 12px;">
          <i class="fas fa-star" style="color: var(--accent);"></i> Premium Amenities
        </label>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px;">
          
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 14px;">
            <input type="checkbox" id="amenity-wifi" onchange="applyFilters()" style="margin: 0;">
            <i class="fas fa-wifi" style="color: var(--primary); width: 16px;"></i>
            WiFi Included
          </label>
          
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 14px;">
            <input type="checkbox" id="amenity-laundry" onchange="applyFilters()" style="margin: 0;">
            <i class="fas fa-tshirt" style="color: var(--primary); width: 16px;"></i>
            Laundry
          </label>
          
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 14px;">
            <input type="checkbox" id="amenity-ac" onchange="applyFilters()" style="margin: 0;">
            <i class="fas fa-snowflake" style="color: var(--primary); width: 16px;"></i>
            Air Conditioning
          </label>
          
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 14px;">
            <input type="checkbox" id="amenity-balcony" onchange="applyFilters()" style="margin: 0;">
            <i class="fas fa-tree" style="color: var(--primary); width: 16px;"></i>
            Balcony/Terrace
          </label>
          
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 14px;">
            <input type="checkbox" id="amenity-transport" onchange="applyFilters()" style="margin: 0;">
            <i class="fas fa-subway" style="color: var(--primary); width: 16px;"></i>
            Near Public Transport
          </label>
          
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 14px;">
            <input type="checkbox" id="amenity-gym" onchange="applyFilters()" style="margin: 0;">
            <i class="fas fa-dumbbell" style="color: var(--primary); width: 16px;"></i>
            Gym/Fitness
          </label>
          
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 14px;">
            <input type="checkbox" id="amenity-dishwasher" onchange="applyFilters()" style="margin: 0;">
            <i class="fas fa-utensils" style="color: var(--primary); width: 16px;"></i>
            Dishwasher
          </label>
          
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 14px;">
            <input type="checkbox" id="amenity-elevator" onchange="applyFilters()" style="margin: 0;">
            <i class="fas fa-arrows-alt-v" style="color: var(--primary); width: 16px;"></i>
            Elevator
          </label>
        </div>
      </div>

      <!-- Filter Results Summary -->
      <div style="border-top: 1px solid #e1e5e9; padding-top: 16px; margin-top: 16px;">
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px;">
          <div id="filter-summary" style="color: var(--muted); font-size: 14px;">
            Showing all apartments
          </div>
          <button onclick="clearAllFilters()" style="
            padding: 6px 12px;
            background: var(--secondary);
            color: var(--muted);
            border: 1px solid #e1e5e9;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
          " onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='var(--secondary)'">
            <i class="fas fa-times"></i> Clear All Filters
          </button>
        </div>
      </div>
    </div>

    <!-- Map Container (Initially Hidden) -->
    <div id="map-container" style="display: none; background: white; border-radius: 18px; box-shadow: var(--shadow); overflow: hidden; margin-bottom: 20px; position: relative;">
      <!-- Close Map Button -->
      <button onclick="document.getElementById('map-container').style.display='none';" style="
        position: absolute;
        top: 10px;
        right: 10px;
        background: #dc3545;
        color: white;
        border: none;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        z-index: 10;
        transition: background 0.2s;
      " onmouseover="this.style.background='#c82333'" onmouseout="this.style.background='#dc3545'" title="Close Map">
        <i class="fa fa-times"></i>
      </button>
      
      <div style="height: 400px; background: #f0f2f5; display: flex; align-items: center; justify-content: center; color: var(--muted);">
        <div style="text-align: center;">
          <i class="fas fa-map" style="font-size: 48px; color: var(--primary); margin-bottom: 16px;"></i>
          <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">Interactive Map View</div>
          <div style="font-size: 14px;">Map integration with Google Maps API will be loaded here</div>
        </div>
      </div>
    </div>
  </div>
        
        </div> <!-- End Filters Grid -->
      </div> <!-- End Advanced Filters -->
      
      <!-- Map Section (Initially Hidden) -->
      <div id="map-section" style="
        display: none;
        border-top: 1px solid #e1e5e9;
        background: #f8f9fa;
        border-radius: 0 0 12px 12px;
        padding: 20px;
        margin-top: 0;
        transition: all 0.3s ease-in-out;
      ">
        <!-- Map Header with Close Button -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h3 style="margin: 0; color: var(--text); font-size: 18px; font-weight: 600;">
            <i class="fas fa-map-marked-alt" style="color: var(--primary); margin-right: 8px;"></i>
            Interactive Map
          </h3>
          <button onclick="document.getElementById('map-section').style.display='none'; document.getElementById('map-toggle-text').textContent='Show Map';" style="
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
          " onmouseover="this.style.background='#c82333'" onmouseout="this.style.background='#dc3545'" title="Close Map">
            <i class="fa fa-times"></i> Close
          </button>
        </div>
        
        <div style="height: 400px; background: #f0f2f5; display: flex; align-items: center; justify-content: center; color: var(--muted); border-radius: 8px;">
          <div style="text-align: center;">
            <i class="fas fa-map" style="font-size: 48px; color: var(--primary); margin-bottom: 16px;"></i>
            <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">Interactive Map View</div>
            <div style="font-size: 14px;">Map integration with Google Maps API will be loaded here</div>
          </div>
        </div>
      </div>
      
      <!-- Filters Section (Initially Hidden) -->
      <div id="filters-section" style="
        display: none;
        border-top: 1px solid #e1e5e9;
        background: #f8f9fa;
        border-radius: 0 0 12px 12px;
        padding: 20px;
        margin-top: 0;
        transition: all 0.3s ease-in-out;
      ">
        <!-- Filters Header with Close Button -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h3 style="margin: 0; color: var(--text); font-size: 18px; font-weight: 600;">
            <i class="fas fa-filter" style="color: var(--accent); margin-right: 8px;"></i>
            Property Filters
          </h3>
          <button onclick="document.getElementById('filters-section').style.display='none';" style="
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
          " onmouseover="this.style.background='#c82333'" onmouseout="this.style.background='#dc3545'" title="Close Filters">
            <i class="fa fa-times"></i> Close
          </button>
        </div>
        
        <!-- Filters Grid -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
          <!-- Property Type -->
          <div>
            <label style="font-weight: 600; color: var(--text); display: block; margin-bottom: 8px;">
              <i class="fas fa-home" style="color: var(--accent);"></i> Property Type
            </label>
            <select style="width: 100%; padding: 8px 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 14px; background: white;">
              <option value="">All Types</option>
              <option value="apartment">Apartment</option>
              <option value="house">House</option>
              <option value="studio">Studio</option>
              <option value="loft">Loft</option>
            </select>
          </div>
          
          <!-- Bathrooms -->
          <div>
            <label style="font-weight: 600; color: var(--text); display: block; margin-bottom: 8px;">
              <i class="fas fa-bath" style="color: var(--accent);"></i> Bathrooms
            </label>
            <select style="width: 100%; padding: 8px 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 14px; background: white;">
              <option value="">Any</option>
              <option value="1">1+</option>
              <option value="2">2+</option>
              <option value="3">3+</option>
            </select>
          </div>
          
          <!-- Furnished Status -->
          <div>
            <label style="font-weight: 600; color: var(--text); display: block; margin-bottom: 8px;">
              <i class="fas fa-couch" style="color: var(--accent);"></i> Furnished
            </label>
            <select style="width: 100%; padding: 8px 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 14px; background: white;">
              <option value="">Any</option>
              <option value="furnished">Furnished</option>
              <option value="unfurnished">Unfurnished</option>
              <option value="semi-furnished">Semi-Furnished</option>
            </select>
          </div>
          
          <!-- Pet Policy -->
          <div>
            <label style="font-weight: 600; color: var(--text); display: block; margin-bottom: 8px;">
              <i class="fas fa-paw" style="color: var(--accent);"></i> Pet Policy
            </label>
            <select style="width: 100%; padding: 8px 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 14px; background: white;">
              <option value="">Any</option>
              <option value="pets-allowed">Pets Allowed</option>
              <option value="no-pets">No Pets</option>
              <option value="cats-only">Cats Only</option>
              <option value="dogs-only">Dogs Only</option>
            </select>
          </div>
          
          <!-- Parking -->
          <div>
            <label style="font-weight: 600; color: var(--text); display: block; margin-bottom: 8px;">
              <i class="fas fa-car" style="color: var(--accent);"></i> Parking
            </label>
            <select style="width: 100%; padding: 8px 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 14px; background: white;">
              <option value="">Any</option>
              <option value="included">Included</option>
              <option value="available">Available (Extra Cost)</option>
              <option value="street-parking">Street Parking</option>
              <option value="no-parking">No Parking</option>
            </select>
          </div>
          
          <!-- Amenities -->
          <div style="grid-column: span 2;">
            <label style="font-weight: 600; color: var(--text); display: block; margin-bottom: 8px;">
              <i class="fas fa-star" style="color: var(--accent);"></i> Amenities
            </label>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 8px;">
              <label style="display: flex; align-items: center; font-size: 14px; cursor: pointer;">
                <input type="checkbox" style="margin-right: 6px;"> Balcony
              </label>
              <label style="display: flex; align-items: center; font-size: 14px; cursor: pointer;">
                <input type="checkbox" style="margin-right: 6px;"> Dishwasher
              </label>
              <label style="display: flex; align-items: center; font-size: 14px; cursor: pointer;">
                <input type="checkbox" style="margin-right: 6px;"> Washing Machine
              </label>
              <label style="display: flex; align-items: center; font-size: 14px; cursor: pointer;">
                <input type="checkbox" style="margin-right: 6px;"> Air Conditioning
              </label>
              <label style="display: flex; align-items: center; font-size: 14px; cursor: pointer;">
                <input type="checkbox" style="margin-right: 6px;"> Elevator
              </label>
              <label style="display: flex; align-items: center; font-size: 14px; cursor: pointer;">
                <input type="checkbox" style="margin-right: 6px;"> Garden Access
              </label>
            </div>
          </div>
        </div>
        
        <!-- Apply Filters Button -->
        <div style="margin-top: 20px; text-align: center;">
          <button style="
            background: var(--accent);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
          " onmouseover="this.style.background='#2BC4B6'" onmouseout="this.style.background='var(--accent)'">
            <i class="fas fa-check"></i> Apply Filters
          </button>
        </div>
      </div>
      
      <!-- Results Summary -->
      <div id="results-summary" style="
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid #e1e5e9;
        font-size: 14px;
        color: var(--text);
        text-align: center;
      "></div>
    </div>
  </div>
  <div class="filters-bar">
    <button onclick="toggleFilters()"><i class="fa fa-filter"></i> Filters</button>
  </div>

  <!-- Unified Filters Modal (B12 Spec Compliant) -->
  <div class="filters-container" id="filters-container">
    <div class="filters-modal">
      
      <!-- Sticky Header -->
      <div class="filters-header" style="position: sticky; top: 0; background: white; z-index: 10; padding: 20px; border-bottom: 2px solid #e1e5e9;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <h2 style="margin: 0; color: var(--primary); font-size: 1.4rem;">
            <i class="fas fa-filter" style="margin-right: 10px;"></i>
            <span data-translate="filters.title">Advanced Filters</span>
          </h2>
          <button class="close-filters" onclick="document.getElementById('filters-container').classList.remove('active');" style="background: #dc3545; color: white; border: none; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center;">×</button>
        </div>
      </div>

      <!-- Scrollable Content -->
      <div class="filters-content" style="overflow-y: auto; overflow-x: hidden; max-height: calc(80vh - 160px); padding: 20px;">
        
        <!-- BASIC FILTERS -->
        
        <!-- City/Area -->
        <div style="margin-bottom: 20px;">
          <label style="font-weight: 600; color: var(--text); display: block; margin-bottom: 8px; font-size: 14px;">
            <i class="fas fa-map-marker-alt" style="color: var(--primary);"></i>
            <span data-translate="filters.city">City/Area</span>
          </label>
          <input type="text" id="city-filter" placeholder="Enter city or area" style="width: 100%; padding: 10px; border: 1px solid #e1e5e9; border-radius: 6px; font-size: 14px;">
        </div>

        <!-- Time Filters -->
        <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid var(--accent);">
          <label style="font-weight: 600; color: var(--text); display: block; margin-bottom: 12px; font-size: 14px;">
            <i class="fas fa-calendar-alt" style="color: var(--accent);"></i>
            <span data-translate="filters.timeSection">Time & Availability</span>
          </label>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
            <div>
              <label style="font-size: 12px; color: var(--muted); display: block; margin-bottom: 4px;" data-translate="filters.moveIn">Move-in Date</label>
              <input type="date" id="move-in-date" style="width: 100%; padding: 8px; border: 1px solid #e1e5e9; border-radius: 4px; font-size: 13px;">
            </div>
            <div>
              <label style="font-size: 12px; color: var(--muted); display: block; margin-bottom: 4px;" data-translate="filters.moveOut">Move-out Date</label>
              <input type="date" id="move-out-date" style="width: 100%; padding: 8px; border: 1px solid #e1e5e9; border-radius: 4px; font-size: 13px;">
            </div>
          </div>
          
          <div style="margin-bottom: 10px;">
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 13px;">
              <input type="checkbox" id="earliest-move-in" style="margin: 0;">
              <i class="fas fa-sort-amount-down" style="color: var(--primary); width: 14px;"></i>
              <span data-translate="filters.earliestMoveIn">Sort by earliest move-in</span>
            </label>
          </div>
          
          <div>
            <label style="font-size: 12px; color: var(--muted); display: block; margin-bottom: 6px;" data-translate="filters.timeFlexibility">Time Flexibility</label>
            <div style="display: flex; gap: 16px;">
              <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 13px;">
                <input type="radio" name="time-flexibility" value="fixed" style="margin: 0;">
                <span data-translate="filters.fixed">Fixed Dates</span>
              </label>
              <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 13px;">
                <input type="radio" name="time-flexibility" value="flexible" checked style="margin: 0;">
                <span data-translate="filters.flexible">Flexible Dates</span>
              </label>
            </div>
          </div>
        </div>

        <!-- Price Range with Kalt/Warm -->
        <div style="margin-bottom: 20px; padding: 15px; background: white; border-radius: 8px; border: 1px solid #e1e5e9;">
          <label style="font-weight: 600; color: var(--text); display: block; margin-bottom: 10px; font-size: 14px;">
            <i class="fas fa-euro-sign" style="color: var(--accent);"></i>
            <span data-translate="filters.priceRange">Price Range & Type</span>
          </label>
          
          <!-- Kalt/Warm Checkboxes -->
          <div style="display: flex; gap: 20px; margin-bottom: 12px;">
            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 13px;">
              <input type="checkbox" id="price-type-kalt" checked style="margin: 0;">
              <i class="fas fa-snowflake" style="color: #6c757d; width: 14px;"></i>
              <span data-translate="filters.kaltmiete">Kaltmiete (Cold Rent)</span>
            </label>
            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 13px;">
              <input type="checkbox" id="price-type-warm" checked style="margin: 0;">
              <i class="fas fa-fire" style="color: #dc3545; width: 14px;"></i>
              <span data-translate="filters.warmmiete">Warmmiete (Warm Rent)</span>
            </label>
          </div>
          
          <!-- Price Inputs -->
          <div style="display: flex; gap: 8px; align-items: center; margin-bottom: 10px;">
            <input type="number" id="min-price" placeholder="Min €" style="width: 90px; padding: 8px; border: 1px solid #e1e5e9; border-radius: 4px; font-size: 13px;">
            <span style="color: var(--muted);">-</span>
            <input type="number" id="max-price" placeholder="Max €" style="width: 90px; padding: 8px; border: 1px solid #e1e5e9; border-radius: 4px; font-size: 13px;">
          </div>
          
          <!-- Price Slider -->
          <input type="range" id="price-range" min="200" max="2000" value="1000" style="width: 100%; height: 4px; border-radius: 2px; background: #e1e5e9; outline: none; -webkit-appearance: none; appearance: none; cursor: pointer;" oninput="updatePriceSlider()">
          <div id="price-display" style="font-size: 11px; color: var(--muted); text-align: center; margin-top: 4px;">€200 - €2000</div>
        </div>

        <!-- Property Type (Multi-select Checkboxes) -->
        <div style="margin-bottom: 20px;">
          <label style="font-weight: 600; color: var(--text); display: block; margin-bottom: 10px; font-size: 14px;">
            <i class="fas fa-home" style="color: var(--primary);"></i>
            <span data-translate="filters.propertyType">Property Type</span>
          </label>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 8px;">
            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 13px;">
              <input type="checkbox" name="property-type" value="shared-room" style="margin: 0;">
              <span data-translate="filters.sharedRoom">Shared Room</span>
            </label>
            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 13px;">
              <input type="checkbox" name="property-type" value="private-room" style="margin: 0;">
              <span data-translate="filters.privateRoom">Private Room</span>
            </label>
            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 13px;">
              <input type="checkbox" name="property-type" value="studio" style="margin: 0;">
              <span data-translate="filters.studio">Studio</span>
            </label>
            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 13px;">
              <input type="checkbox" name="property-type" value="loft" style="margin: 0;">
              <span data-translate="filters.loft">Loft</span>
            </label>
            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 13px;">
              <input type="checkbox" name="property-type" value="apartment" style="margin: 0;">
              <span data-translate="filters.apartment">Apartment</span>
            </label>
            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 13px;">
              <input type="checkbox" name="property-type" value="house" style="margin: 0;">
              <span data-translate="filters.house">House</span>
            </label>
          </div>
        </div>

        <!-- Rooms & Beds -->
        <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
          <label style="font-weight: 600; color: var(--text); display: block; margin-bottom: 12px; font-size: 14px;">
            <i class="fas fa-bed" style="color: var(--primary);"></i>
            <span data-translate="filters.roomsAndBeds">Rooms & Beds</span>
          </label>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px;">
            <div>
              <label style="font-size: 12px; color: var(--muted); display: block; margin-bottom: 4px;" data-translate="filters.roomsCount">Number of Rooms</label>
              <select id="rooms-count" style="width: 100%; padding: 8px; border: 1px solid #e1e5e9; border-radius: 4px; font-size: 13px;">
                <option value="">Any</option>
                <option value="1">1 Room</option>
                <option value="2">2 Rooms</option>
                <option value="3">3 Rooms</option>
                <option value="4">4+ Rooms</option>
              </select>
            </div>
            <div>
              <label style="font-size: 12px; color: var(--muted); display: block; margin-bottom: 4px;" data-translate="filters.singleBeds">Single Beds</label>
              <select id="single-beds" style="width: 100%; padding: 8px; border: 1px solid #e1e5e9; border-radius: 4px; font-size: 13px;">
                <option value="">Any</option>
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3+</option>
              </select>
            </div>
            <div>
              <label style="font-size: 12px; color: var(--muted); display: block; margin-bottom: 4px;" data-translate="filters.doubleBeds">Double Beds</label>
              <select id="double-beds" style="width: 100%; padding: 8px; border: 1px solid #e1e5e9; border-radius: 4px; font-size: 13px;">
                <option value="">Any</option>
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3+</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Furnished Status -->
        <div style="margin-bottom: 20px;">
          <label style="font-weight: 600; color: var(--text); display: block; margin-bottom: 8px; font-size: 14px;">
            <i class="fas fa-couch" style="color: var(--primary);"></i>
            <span data-translate="filters.furnished">Furnished Status</span>
          </label>
          <select id="furnished-filter" style="width: 100%; padding: 10px; border: 1px solid #e1e5e9; border-radius: 6px; font-size: 14px;">
            <option value="">Any</option>
            <option value="furnished">Furnished</option>
            <option value="unfurnished">Unfurnished</option>
            <option value="semi-furnished">Semi-Furnished</option>
          </select>
        </div>

        <!-- ADVANCED FILTERS (Collapsible) -->
        <details open style="margin-bottom: 20px; border: 1px solid #e1e5e9; border-radius: 8px; padding: 15px; background: white;">
          <summary style="font-weight: 600; color: var(--primary); cursor: pointer; font-size: 14px; margin-bottom: 10px;">
            <i class="fas fa-sliders-h" style="margin-right: 8px;"></i>
            <span data-translate="filters.advancedAmenities">Advanced Amenities</span>
          </summary>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 10px; margin-top: 12px;">
            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 12px;">
              <input type="checkbox" name="amenity" value="washing_machine" style="margin: 0;">
              <i class="fas fa-tshirt" style="color: var(--primary); width: 14px;"></i>
              Washing Machine
            </label>
            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 12px;">
              <input type="checkbox" name="amenity" value="dryer" style="margin: 0;">
              <i class="fas fa-wind" style="color: var(--primary); width: 14px;"></i>
              Dryer
            </label>
            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 12px;">
              <input type="checkbox" name="amenity" value="dishwasher" style="margin: 0;">
              <i class="fas fa-utensils" style="color: var(--primary); width: 14px;"></i>
              Dishwasher
            </label>
            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 12px;">
              <input type="checkbox" name="amenity" value="tv" style="margin: 0;">
              <i class="fas fa-tv" style="color: var(--primary); width: 14px;"></i>
              TV
            </label>
            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 12px;">
              <input type="checkbox" name="amenity" value="lift" style="margin: 0;">
              <i class="fas fa-arrows-alt-v" style="color: var(--primary); width: 14px;"></i>
              Lift/Elevator
            </label>
            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 12px;">
              <input type="checkbox" name="amenity" value="kitchen" style="margin: 0;">
              <i class="fas fa-utensils-alt" style="color: var(--primary); width: 14px;"></i>
              Kitchen
            </label>
            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 12px;">
              <input type="checkbox" name="amenity" value="air_conditioning" style="margin: 0;">
              <i class="fas fa-snowflake" style="color: var(--primary); width: 14px;"></i>
              Air Conditioning
            </label>
            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 12px;">
              <input type="checkbox" name="amenity" value="wifi" style="margin: 0;">
              <i class="fas fa-wifi" style="color: var(--primary); width: 14px;"></i>
              WiFi
            </label>
            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 12px;">
              <input type="checkbox" name="amenity" value="heating" style="margin: 0;">
              <i class="fas fa-fire" style="color: var(--primary); width: 14px;"></i>
              Heating
            </label>
            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 12px;">
              <input type="checkbox" name="amenity" value="private_bathroom" style="margin: 0;">
              <i class="fas fa-bath" style="color: var(--primary); width: 14px;"></i>
              Private Bathroom
            </label>
            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 12px;">
              <input type="checkbox" name="amenity" value="wheelchair_accessible" style="margin: 0;">
              <i class="fas fa-wheelchair" style="color: var(--primary); width: 14px;"></i>
              Wheelchair Access
            </label>
            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 12px;">
              <input type="checkbox" name="amenity" value="balcony" style="margin: 0;">
              <i class="fas fa-tree" style="color: var(--primary); width: 14px;"></i>
              Balcony/Terrace
            </label>
          </div>
        </details>

        <!-- More Filters -->
        <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
          <label style="font-weight: 600; color: var(--text); display: block; margin-bottom: 12px; font-size: 14px;">
            <i class="fas fa-cog" style="color: var(--primary);"></i>
            <span data-translate="filters.moreFilters">More Filters</span>
          </label>
          
          <div style="margin-bottom: 10px;">
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 13px;">
              <input type="checkbox" id="exclude-exchange" style="margin: 0;">
              <i class="fas fa-exchange-alt" style="color: var(--muted); width: 14px;"></i>
              <span data-translate="filters.excludeExchange">Exclude Exchange Offers</span>
            </label>
          </div>
          
          <div>
            <label style="font-size: 12px; color: var(--muted); display: block; margin-bottom: 6px;" data-translate="filters.petsPolicy">Pets Policy</label>
            <div style="display: flex; gap: 16px;">
              <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 13px;">
                <input type="radio" name="pets-policy" value="any" checked style="margin: 0;">
                Any
              </label>
              <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 13px;">
                <input type="radio" name="pets-policy" value="allowed" style="margin: 0;">
                <span data-translate="filters.petsAllowed">Pets Allowed</span>
              </label>
              <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 13px;">
                <input type="radio" name="pets-policy" value="not_allowed" style="margin: 0;">
                <span data-translate="filters.petsNotAllowed">No Pets</span>
              </label>
            </div>
          </div>
        </div>

      </div>

      <!-- Sticky Footer (Actions) -->
      <div class="filters-actions" style="position: sticky; bottom: 0; background: white; border-top: 2px solid #e1e5e9; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; z-index: 10;">
        <div id="filter-summary" style="color: var(--muted); font-size: 13px; flex: 1;">
          <i class="fas fa-info-circle"></i> <span data-translate="filters.showingAll">Showing all apartments</span>
        </div>
        <div style="display: flex; gap: 10px;">
          <button onclick="clearAllFilters()" style="background: var(--muted); color: white; border: none; padding: 10px 20px; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='#374151'" onmouseout="this.style.background='var(--muted)'">
            <i class="fa fa-times"></i> <span data-translate="filters.clearAll">Clear All</span>
          </button>
          <button class="apply-filters" onclick="applyModalFilters()" style="background: var(--primary); color: white; border: none; padding: 10px 24px; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='#1d4ed8'" onmouseout="this.style.background='var(--primary)'">
            <i class="fas fa-search"></i> <span data-translate="filters.applyFilters">Apply Filters</span>
          </button>
        </div>
      </div>

    </div>
  </div>

    <div class="listings" id="listings-container">
    <!-- Dynamic apartments will be loaded here -->
  </div>

  <footer style="background: var(--primary); color: #fff; padding: 32px 0 16px 0; text-align: center; margin-top: 60px;">
    <div style="margin-bottom: 12px; display: flex; justify-content: center; gap: 24px; flex-wrap: wrap;">
      <a href="about.html" style="color:#fff;text-decoration:none;font-weight:500;font-family:var(--heading-font);transition:color 0.2s;">About</a>
      <a href="faq.html" style="color:#fff;text-decoration:none;font-weight:500;font-family:var(--heading-font);transition:color 0.2s;">FAQ</a>
      <a href="customer-service.html" style="color:#fff;text-decoration:none;font-weight:500;font-family:var(--heading-font);transition:color 0.2s;">Customer Service</a>
      <a href="marketplace.html" style="color:#fff;text-decoration:none;font-weight:500;font-family:var(--heading-font);transition:color 0.2s;">Marketplace</a>
      <a href="scam-stories.html" style="color:#fff;text-decoration:none;font-weight:500;font-family:var(--heading-font);transition:color 0.2s;">Scam Stories</a>
    </div>
    <div style="margin-top:10px;display:flex;justify-content:center;gap:18px;">
      <a href="#" style="color:#fff;font-size:1.3rem;transition:color 0.2s;"><i class="fab fa-linkedin"></i></a>
      <a href="#" style="color:#fff;font-size:1.3rem;transition:color 0.2s;"><i class="fab fa-facebook"></i></a>
      <a href="#" style="color:#fff;font-size:1.3rem;transition:color 0.2s;"><i class="fab fa-instagram"></i></a>
    </div>
    <p style="margin-top:16px;">&copy; 2025 SichrPlace. All rights reserved.<br>
      Created by <a href="https://www.linkedin.com/in/z%C3%A9t%C3%A9ny-dobos/?originalSubdomain=hu" style="color:#40E0D0;">Zétény Dobos</a> and <a href="https://www.linkedin.com/in/%C3%B6mer-%C3%BC%C3%A7kale-482787202/" style="color:#40E0D0;">Ömer Üçkale</a>.
    </p>
  </footer>

  <script>
    // ================================
    // 🎯 REAL-TIME APARTMENT DATA LOADING
    // ================================
    
    let apartmentsData = []; // Global storage for apartment data
    const favoriteOffers = new Set();
    const API_BASE_URL = 'http://localhost:3000'; // Your working backend
    
    async function loadApartments() {
      try {
        const response = await fetch(`${API_BASE_URL}/api/apartments`);
        const data = await response.json();
        
        if (data.success && data.data) {
          apartmentsData = data.data;
          renderApartments(apartmentsData);
        } else {
          console.error('Failed to load apartments:', data.error);
        }
      } catch (error) {
        console.error('Failed to load apartments:', error);
      }
    }
    
    // Render apartments in the listings container
    function renderApartments(apartments) {
      const container = document.getElementById('listings-container');
      
      if (!apartments || apartments.length === 0) {
        container.innerHTML = `
          <div style="text-align: center; padding: 40px; color: var(--muted);">
            <i class="fa fa-home" style="font-size: 24px; margin-bottom: 16px;"></i>
            <p>No apartments found matching your criteria.</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = apartments.map(apartment => `
        <div class="listing" onclick="openOfferDetails('${apartment.id}')" style="cursor: pointer;">
          <div class="listing-image" style="background-image: url('${getApartmentImage(apartment)}');"></div>
          <div class="listing-details">
            <h3 class="listing-title">${apartment.title || apartment.address}</h3>
            <p class="listing-location">
              <i class="fas fa-map-marker-alt"></i> ${apartment.location}
            </p>
            <div class="listing-price">€${apartment.price}/month</div>
            
            <div class="listing-features">
              <div class="listing-feature">
                <i class="fas fa-bed"></i> 
                <span>${apartment.bedrooms || apartment.rooms || 'N/A'} bed${(apartment.bedrooms || apartment.rooms) > 1 ? 's' : ''}</span>
              </div>
              <div class="listing-feature">
                <i class="fas fa-bath"></i> 
                <span>${apartment.bathrooms || 'N/A'} bath${apartment.bathrooms > 1 ? 's' : ''}</span>
              </div>
              <div class="listing-feature">
                <i class="fas fa-expand-arrows-alt"></i> 
                <span>${apartment.area || apartment.size}m²</span>
              </div>
            </div>
            
            <div class="listing-tags">
              ${apartment.petPolicy ? `<span class="property-tag ${apartment.petPolicy === 'pet-friendly' ? 'pet-friendly' : apartment.petPolicy === 'no-pets' ? 'no-pets' : 'pets-conditional'}">
                ${formatPetPolicy(apartment.petPolicy)}
              </span>` : ''}
              
              ${apartment.furnished ? `<span class="property-tag ${apartment.furnished === 'furnished' ? 'furnished' : ''}">
                ${formatFurnished(apartment.furnished)}
              </span>` : ''}
              
              ${apartment.parking ? `<span class="property-tag parking">
                ${formatParking(apartment.parking)}
              </span>` : ''}
            </div>
            
            ${apartment.amenities && apartment.amenities.length > 0 ? `
              <div class="listing-amenities">
                ${apartment.amenities.slice(0, 3).map(amenity => `
                  <span class="property-tag">${formatAmenity(amenity)}</span>
                `).join('')}
                ${apartment.amenities.length > 3 ? `<span class="property-tag">+${apartment.amenities.length - 3} more</span>` : ''}
              </div>
            ` : ''}
            
            <div class="listing-actions">
              <div style="font-size: 0.9rem; color: var(--muted);">
                Move-in: ${formatDate(apartment.move_in_date)}
                ${apartment.average_rating ? ` | ⭐ ${apartment.average_rating}` : ''}
              </div>
              <button class="view-details-btn" onclick="event.stopPropagation(); openOfferDetails('${apartment.id}')">
                View Details
              </button>
            </div>
          </div>
        </div>
      `).join('');
    }
    
    // Helper functions for data formatting
    function getApartmentImage(apartment) {
      if (apartment.images && apartment.images.length > 0) {
        return apartment.images[0];
      }
      // Fallback to default images
      const defaultImages = ['apartment1.jpg', 'apartment2.jpg', 'koeln.jpg', 'koeln2.jpg'];
      const randomImage = defaultImages[Math.floor(Math.random() * defaultImages.length)];
      return `./img/${randomImage}`;
    }
    
    function formatPropertyType(type) {
      if (!type) return 'N/A';
      return type.charAt(0).toUpperCase() + type.slice(1).replace(/[_-]/g, ' ');
    }
    
    // New formatting functions for enhanced filters
    function formatPetPolicy(policy) {
      const policies = {
        'pet-friendly': 'Pet-friendly',
        'no-pets': 'No pets',
        'cats-only': 'Cats only',
        'dogs-only': 'Dogs only'
      };
      return policies[policy] || policy;
    }
    
    function formatFurnished(status) {
      const statuses = {
        'furnished': 'Furnished',
        'unfurnished': 'Unfurnished',
        'semi-furnished': 'Semi-furnished'
      };
      return statuses[status] || status;
    }
    
    function formatParking(parking) {
      const types = {
        'included': 'Parking included',
        'garage': 'Garage parking',
        'street': 'Street parking',
        'none': 'No parking'
      };
      return types[parking] || parking;
    }
    
    function formatAmenity(amenity) {
      const amenities = {
        'wifi': '📶 WiFi',
        'laundry': '🧺 Laundry',
        'ac': '❄️ A/C',
        'balcony': '🏠 Balcony',
        'transport': '🚇 Transport',
        'gym': '💪 Gym',
        'dishwasher': '🍽️ Dishwasher',
        'elevator': '🛗 Elevator'
      };
      return amenities[amenity] || amenity;
    }
    
    
    function formatDate(dateString) {
      if (!dateString) return null;
      const date = new Date(dateString);
      return date.toLocaleDateString('en-GB', {
        day: '2-digit',
        month: '2-digit', 
        year: 'numeric'
      });
    }
    
    function renderStars(rating) {
      const stars = [];
      const fullStars = Math.floor(rating);
      const hasHalfStar = rating % 1 >= 0.5;
      
      for (let i = 0; i < fullStars; i++) {
        stars.push('<i class="fa fa-star" style="color: #FFD700;"></i>');
      }
      if (hasHalfStar) {
        stars.push('<i class="fa fa-star-half-alt" style="color: #FFD700;"></i>');
      }
      const emptyStars = 5 - Math.ceil(rating);
      for (let i = 0; i < emptyStars; i++) {
        stars.push('<i class="fa fa-star" style="color: #E5E7EB;"></i>');
      }
      
      return stars.join('');
    }
    
    // ================================
    // 🔄 EXISTING FUNCTIONALITY (Updated)
    // ================================
    
    // Toggle filters functionality
    function toggleFilters() {
      var element = document.getElementById('filters-container');
      
      if (element) {
        if (element.style.display === 'none' || element.style.display === '') {
          element.style.display = 'block';
        } else {
          element.style.display = 'none';
        }
      }
    }

    // Enhanced Price Filtering with Kalt/Warm Miete
    function applyPriceFilters() {
      const kaltChecked = document.getElementById('price-type-kalt').checked;
      const warmChecked = document.getElementById('price-type-warm').checked;
      const minPrice = document.getElementById('min-price').value;
      const maxPrice = document.getElementById('max-price').value;
      
      console.log('Applying price filters:', {
        kalt: kaltChecked,
        warm: warmChecked,
        min: minPrice,
        max: maxPrice
      });
      
      // Apply filters and update apartment listings
      applyAllFilters();
    }

    // Handle price range input changes
    function handlePriceFilter() {
      const minPrice = document.getElementById('min-price').value;
      const maxPrice = document.getElementById('max-price').value;
      const priceRange = document.getElementById('price-range');
      const priceDisplay = document.getElementById('price-display');
      
      if (minPrice && maxPrice) {
        priceDisplay.textContent = `€${minPrice} - €${maxPrice}`;
        // Update slider to middle value
        priceRange.value = (parseInt(minPrice) + parseInt(maxPrice)) / 2;
      }
      
      // Apply filters after a short delay
      setTimeout(applyAllFilters, 300);
    }

    // Update price slider display
    function updatePriceSlider() {
      const priceRange = document.getElementById('price-range');
      const priceDisplay = document.getElementById('price-display');
      const value = priceRange.value;
      
      // Set min and max based on slider value
      const minPrice = Math.max(200, value - 200);
      const maxPrice = Math.min(2000, parseInt(value) + 200);
      
      document.getElementById('min-price').value = minPrice;
      document.getElementById('max-price').value = maxPrice;
      priceDisplay.textContent = `€${minPrice} - €${maxPrice}`;
      
      // Apply filters
      applyAllFilters();
    }

    // Apply all filters together
    function applyAllFilters() {
      const filters = {
        kalt: document.getElementById('price-type-kalt')?.checked || false,
        warm: document.getElementById('price-type-warm')?.checked || false,
        minPrice: document.getElementById('min-price')?.value || '',
        maxPrice: document.getElementById('max-price')?.value || '',
        bedrooms: document.getElementById('bedrooms-filter')?.value || '',
        propertyType: document.getElementById('property-type-filter')?.value || '',
        furnished: document.getElementById('furnished-filter')?.value || '',
        pets: document.getElementById('pet-filter')?.value || '',
        amenities: {
          wifi: document.getElementById('amenity-wifi')?.checked || false,
          laundry: document.getElementById('amenity-laundry')?.checked || false,
          ac: document.getElementById('amenity-ac')?.checked || false,
          balcony: document.getElementById('amenity-balcony')?.checked || false,
          transport: document.getElementById('amenity-transport')?.checked || false,
          elevator: document.getElementById('amenity-elevator')?.checked || false
        }
      };
      
      console.log('Applying filters:', filters);
      
      // Filter apartments based on criteria
      let filteredApartments = apartmentsData;
      
      // Price filtering
      if (filters.minPrice || filters.maxPrice) {
        filteredApartments = filteredApartments.filter(apt => {
          const price = parseInt(apt.price?.replace(/[€,]/g, '')) || 0;
          const min = filters.minPrice ? parseInt(filters.minPrice) : 0;
          const max = filters.maxPrice ? parseInt(filters.maxPrice) : Infinity;
          return price >= min && price <= max;
        });
      }
      
      // Room filtering
      if (filters.bedrooms) {
        filteredApartments = filteredApartments.filter(apt => {
          const rooms = parseInt(apt.rooms) || 0;
          if (filters.bedrooms === '4') return rooms >= 4;
          return rooms == parseInt(filters.bedrooms);
        });
      }
      
      // Property type filtering
      if (filters.propertyType) {
        filteredApartments = filteredApartments.filter(apt => 
          apt.type?.toLowerCase().includes(filters.propertyType.toLowerCase())
        );
      }
      
      // Update filter summary
      const summary = document.getElementById('filter-summary');
      if (summary) {
        const activeFilters = [];
        if (filters.kalt) activeFilters.push('Kaltmiete');
        if (filters.warm) activeFilters.push('Warmmiete');
        if (filters.minPrice || filters.maxPrice) activeFilters.push('Price Range');
        if (filters.bedrooms) activeFilters.push('Bedrooms');
        if (filters.propertyType) activeFilters.push('Property Type');
        
        if (activeFilters.length > 0) {
          summary.textContent = `Showing ${filteredApartments.length} apartments with filters: ${activeFilters.join(', ')}`;
        } else {
          summary.textContent = `Showing all ${filteredApartments.length} apartments`;
        }
      }
      
      // Re-render apartments
      displayApartments(filteredApartments);
    }

    // Clear all filters
    function clearAllFilters() {
      // Reset checkboxes
      document.getElementById('price-type-kalt').checked = false;
      document.getElementById('price-type-warm').checked = false;
      
      // Reset inputs
      document.getElementById('min-price').value = '';
      document.getElementById('max-price').value = '';
      document.getElementById('price-range').value = 1000;
      document.getElementById('price-display').textContent = '€200 - €2000';
      
      // Reset selects
      document.getElementById('bedrooms-filter').value = '';
      document.getElementById('property-type-filter').value = '';
      document.getElementById('furnished-filter').value = '';
      document.getElementById('pet-filter').value = '';
      
      // Reset amenity checkboxes
      const amenityCheckboxes = [
        'amenity-wifi', 'amenity-laundry', 'amenity-ac', 
        'amenity-balcony', 'amenity-transport', 'amenity-elevator'
      ];
      amenityCheckboxes.forEach(id => {
        const checkbox = document.getElementById(id);
        if (checkbox) checkbox.checked = false;
      });
      
      // Apply filters (which will show all apartments)
      applyAllFilters();
    }
  
    // Track apartment view for recently viewed
    async function trackApartmentView(apartmentId) {
      const token = localStorage.getItem('userToken');
      if (!token) return; // Only track for logged-in users
      
      try {
        await fetch(`${API_BASE_URL}/api/recently-viewed`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({ apartmentId })
        });
      } catch (error) {
        console.log('Failed to track apartment view:', error);
        // Don't show error to user as this is background tracking
      }
    }
  
    function openOfferDetails(apartmentId) {
      // Find the apartment data
      const apartment = apartmentsData.find(apt => apt.id.toString() === apartmentId.toString());
      
      if (apartment) {
        // Track this view for recently viewed
        trackApartmentView(apartmentId);
        
        // Store apartment data in URL for offer.html
        const params = new URLSearchParams({
          id: apartment.id,
          title: apartment.title || apartment.address,
          price: apartment.price,
          size: apartment.size,
          rooms: apartment.rooms,
          bathrooms: apartment.bathrooms
        });
        
        window.location.href = `offer.html?${params.toString()}`;
      } else {
        console.error('Apartment details not found for ID:', apartmentId);
      }
    }
  
    // Enhanced favorite system with backend integration
    async function toggleFavorite(event, apartmentId) {
      event.stopPropagation(); // Prevent modal from opening
      
      // Check if user is logged in
      const token = localStorage.getItem('userToken');
      if (!token) {
        alert('Please login to save favorites');
        window.location.href = 'login-new.html';
        return;
      }
      
      const button = event.target.closest('.favorite-button');
      const icon = button.querySelector('i');
      
      try {
        // Show loading state
        button.disabled = true;
        icon.className = 'fa fa-spinner fa-spin';
        
        const response = await fetch(`${API_BASE_URL}/api/favorites`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({ apartmentId })
        });
        
        const data = await response.json();
        
        if (response.ok && data.success) {
          // Update local state and UI
          if (data.action === 'added') {
            favoriteOffers.add(apartmentId);
            icon.className = 'fa fa-heart';
            button.innerHTML = '<i class="fa fa-heart"></i> Remove from Favorites';
            button.style.background = '#EF4444';
            showNotification('Apartment added to favorites!', 'success');
          } else {
            favoriteOffers.delete(apartmentId);
            icon.className = 'fa fa-heart-o';
            button.innerHTML = '<i class="fa fa-heart-o"></i> Add to Favorites';
            button.style.background = '';
            showNotification('Apartment removed from favorites.', 'info');
          }
          // Update favorites counter
          updateFavoritesCounter();
        } else {
          showNotification(data.error || 'Failed to update favorites', 'error');
        }
      } catch (error) {
        console.error('Failed to toggle favorite:', error);
        showNotification('Failed to update favorites. Please try again.', 'error');
      } finally {
        // Reset button state
        button.disabled = false;
        if (!button.innerHTML.includes('spin')) {
          // Only reset if still in loading state
          updateFavoriteButtonState(button, apartmentId);
        }
      }
    }
    
    // Load user favorites from backend
    async function loadUserFavorites() {
      const token = localStorage.getItem('userToken');
      if (!token) return;
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/favorites`, {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          if (data.success) {
            // Clear existing favorites
            favoriteOffers.clear();
            // Add current favorites
            data.data.forEach(fav => {
              favoriteOffers.add(fav.apartment_id);
            });
            // Update all favorite buttons
            updateAllFavoriteButtons();
          }
        }
      } catch (error) {
        console.error('Failed to load user favorites:', error);
      }
    }
    
    // Update favorite button state
    function updateFavoriteButtonState(button, apartmentId) {
      const icon = button.querySelector('i');
      if (favoriteOffers.has(apartmentId)) {
        icon.className = 'fa fa-heart';
        button.innerHTML = '<i class="fa fa-heart"></i> Remove from Favorites';
        button.style.background = '#EF4444';
      } else {
        icon.className = 'fa fa-heart-o';
        button.innerHTML = '<i class="fa fa-heart-o"></i> Add to Favorites';
        button.style.background = '';
      }
    }
    
    // Update all favorite buttons
    function updateAllFavoriteButtons() {
      document.querySelectorAll('.favorite-button').forEach(button => {
        const apartmentId = button.getAttribute('onclick').match(/'([^']+)'/)[1];
        updateFavoriteButtonState(button, apartmentId);
      });
      // Update favorites counter
      updateFavoritesCounter();
    }
    
    // Update favorites counter in navigation
    function updateFavoritesCounter() {
      const counter = document.querySelector('#favorites-counter');
      if (counter) {
        const count = favoriteOffers.size;
        counter.textContent = count > 0 ? `${count}` : '';
        counter.style.display = count > 0 ? 'inline' : 'none';
      }
    }
    
    // Show notification helper
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 20px;
        background: ${type === 'success' ? '#10B981' : type === 'error' ? '#EF4444' : '#3B82F6'};
        color: white;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 1000;
        opacity: 0;
        transform: translateX(100%);
        transition: all 0.3s ease;
      `;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      // Animate in
      setTimeout(() => {
        notification.style.opacity = '1';
        notification.style.transform = 'translateX(0)';
      }, 100);
      
      // Remove after 3 seconds
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      }, 3000);
    }

    // Load user favorites from API
    async function loadUserFavorites() {
      const token = localStorage.getItem('userToken');
      if (!token) return;
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/user/favorites`, {
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          if (data.success && data.data) {
            // Update local favorites set
            favoriteOffers.clear();
            data.data.forEach(fav => {
              favoriteOffers.add(fav.apartment_id.toString());
            });
            
            // Update all favorite buttons
            favoriteOffers.forEach(apartmentId => {
              updateFavoriteButton(apartmentId);
            });
          }
        }
      } catch (error) {
        console.error('Failed to load user favorites:', error);
      }
    }
  
    function updateFavoriteButton(apartmentId) {
      const buttons = document.querySelectorAll(`button[onclick*="${apartmentId}"]`);
      buttons.forEach(button => {
        const icon = button.querySelector('i');
        if (favoriteOffers.has(apartmentId)) {
          button.innerHTML = '<i class="fa fa-heart" style="color: #F87171;"></i> Remove from Favorites';
          button.style.background = '#FEE2E2';
          button.style.color = '#F87171';
        } else {
          button.innerHTML = '<i class="fa fa-heart"></i> Add to Favorites';
          button.style.background = '#10B981';
          button.style.color = 'white';
        }
      });
    }
    
    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      console.log('🚀 Loading apartments from backend...');
      loadApartments();
      updateNavigation();
      
      // Initialize price slider display
      const priceSlider = document.getElementById('price-range');
      const priceDisplay = document.getElementById('price-display');
      if (priceSlider && priceDisplay) {
        priceDisplay.textContent = `€200 - €${priceSlider.value}`;
      }
      
      // Set up event listeners for real-time filtering
      const searchInput = document.getElementById('search-input');
      if (searchInput) {
        searchInput.addEventListener('input', applyFilters);
      }
      
      const priceInputs = ['min-price', 'max-price'];
      priceInputs.forEach(id => {
        const input = document.getElementById(id);
        if (input) {
          input.addEventListener('input', applyFilters);
        }
      });
      
      const filterSelects = ['bedrooms-filter', 'bathrooms-filter', 'pet-filter', 'furnished-filter', 'parking-filter'];
      filterSelects.forEach(id => {
        const select = document.getElementById(id);
        if (select) {
          select.addEventListener('change', applyFilters);
        }
      });
      
      const amenityCheckboxes = ['amenity-wifi', 'amenity-laundry', 'amenity-ac', 'amenity-balcony', 'amenity-transport', 'amenity-gym', 'amenity-dishwasher', 'amenity-elevator'];
      amenityCheckboxes.forEach(id => {
        const checkbox = document.getElementById(id);
        if (checkbox) {
          checkbox.addEventListener('change', applyFilters);
        }
      });
      
      // Check authentication status
      const token = localStorage.getItem('userToken');
      if (token) {
        console.log('✅ User authenticated - loading favorites...');
        loadUserFavorites();
        updateNotificationCounter();
      }
      
      console.log('🎯 Advanced search system initialized with comprehensive filters!');
      
      // 🔥 INITIALIZE BULLETPROOF PAYPAL FOR VIEWING PAYMENTS
      initializeBulletproofPayPal();
    });
    
    // 🔥 BULLETPROOF PAYPAL VIEWING PAYMENT INTEGRATION
    async function initializeBulletproofPayPal() {
      try {
        console.log('🔄 Initializing bulletproof PayPal for apartment viewing...');
        
        // Wait for bulletproof PayPal integration to load
        if (typeof window.bulletproofPayPal === 'undefined') {
          console.warn('⚠️ Bulletproof PayPal integration not loaded');
          return;
        }
        
        console.log('✅ Bulletproof PayPal integration ready for viewing payments!');
        
      } catch (error) {
        console.error('❌ PayPal initialization failed:', error);
      }
    }
    
    // 🏠 APARTMENT VIEWING PAYMENT FUNCTION (€25)
    async function initiateViewingPayment(apartmentId, apartmentTitle = 'Apartment Viewing') {
      try {
        // Check if user is logged in
        const token = localStorage.getItem('userToken');
        if (!token) {
          alert('Please login to pay for apartment viewing');
          window.location.href = 'login.html';
          return;
        }
        
        // Show payment modal
        const modal = createViewingPaymentModal(apartmentId, apartmentTitle);
        document.body.appendChild(modal);
        
        // Initialize PayPal button in modal
        await window.bulletproofPayPal.createViewingPaymentButton('viewing-paypal-button', {
          apartmentId: apartmentId,
          viewingRequestId: 'vr_' + apartmentId + '_' + Date.now(),
          apartmentTitle: apartmentTitle,
          onSuccess: (result) => {
            console.log('✅ Viewing payment successful:', result);
            showViewingPaymentSuccess(result, apartmentTitle);
            modal.remove();
          },
          onError: (error) => {
            console.error('❌ Viewing payment failed:', error);
            showViewingPaymentError(error);
          },
          onCancel: () => {
            console.log('❌ Viewing payment cancelled');
            modal.remove();
          }
        });
        
      } catch (error) {
        console.error('❌ Failed to initiate viewing payment:', error);
        alert('Failed to initialize viewing payment. Please try again.');
      }
    }
    
    // 🎨 CREATE VIEWING PAYMENT MODAL
    function createViewingPaymentModal(apartmentId, apartmentTitle) {
      const modal = document.createElement('div');
      modal.className = 'viewing-payment-modal';
      modal.innerHTML = `
        <div class="viewing-payment-overlay" onclick="this.parentElement.remove()"></div>
        <div class="viewing-payment-content">
          <div class="viewing-payment-header">
            <h2><i class="fa fa-eye"></i> Pay for Apartment Viewing</h2>
            <button class="close-btn" onclick="this.parentElement.parentElement.remove()">
              <i class="fa fa-times"></i>
            </button>
          </div>
          
          <div class="viewing-payment-details">
            <div class="apartment-info">
              <h3><i class="fa fa-home"></i> ${apartmentTitle}</h3>
              <p><i class="fa fa-info-circle"></i> Viewing access includes:</p>
              <ul>
                <li><i class="fa fa-check"></i> Full apartment details</li>
                <li><i class="fa fa-check"></i> Landlord contact information</li>
                <li><i class="fa fa-check"></i> Schedule viewing appointments</li>
                <li><i class="fa fa-check"></i> High-resolution photos</li>
                <li><i class="fa fa-check"></i> 24-hour access validity</li>
              </ul>
            </div>
            
            <div class="payment-amount">
              <div class="amount-display">
                <span class="currency">€</span>
                <span class="amount">25.00</span>
              </div>
              <p class="amount-description">One-time viewing fee</p>
            </div>
            
            <div class="paypal-container">
              <div id="viewing-paypal-button"></div>
            </div>
            
            <div class="payment-security">
              <p><i class="fa fa-shield-alt"></i> Secure payment powered by PayPal</p>
              <p><i class="fa fa-lock"></i> Your payment information is protected</p>
            </div>
          </div>
        </div>
      `;
      
      // Add modal styles
      const styles = `
        <style>
          .viewing-payment-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
          }
          
          .viewing-payment-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
          }
          
          .viewing-payment-content {
            position: relative;
            background: white;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
          }
          
          @keyframes modalSlideIn {
            from {
              opacity: 0;
              transform: translateY(-50px) scale(0.9);
            }
            to {
              opacity: 1;
              transform: translateY(0) scale(1);
            }
          }
          
          .viewing-payment-header {
            padding: 30px 30px 20px;
            border-bottom: 1px solid #E5E7EB;
            display: flex;
            justify-content: space-between;
            align-items: center;
          }
          
          .viewing-payment-header h2 {
            margin: 0;
            color: #2563EB;
            font-size: 24px;
            font-weight: 600;
          }
          
          .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            color: #6B7280;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.2s;
          }
          
          .close-btn:hover {
            background: #F3F4F6;
            color: #374151;
          }
          
          .viewing-payment-details {
            padding: 30px;
          }
          
          .apartment-info h3 {
            color: #374151;
            margin: 0 0 15px 0;
            font-size: 20px;
          }
          
          .apartment-info p {
            color: #6B7280;
            margin: 15px 0 10px 0;
            font-weight: 500;
          }
          
          .apartment-info ul {
            list-style: none;
            padding: 0;
            margin: 0;
          }
          
          .apartment-info li {
            padding: 8px 0;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 10px;
          }
          
          .apartment-info li i {
            color: #10B981;
            width: 16px;
          }
          
          .payment-amount {
            text-align: center;
            margin: 30px 0;
            padding: 25px;
            background: linear-gradient(135deg, #2563EB, #40E0D0);
            border-radius: 15px;
            color: white;
          }
          
          .amount-display {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 5px;
          }
          
          .currency {
            font-size: 32px;
            opacity: 0.9;
          }
          
          .amount-description {
            font-size: 16px;
            opacity: 0.9;
            margin: 0;
          }
          
          .paypal-container {
            margin: 30px 0;
          }
          
          .payment-security {
            text-align: center;
            margin-top: 20px;
          }
          
          .payment-security p {
            margin: 5px 0;
            color: #6B7280;
            font-size: 14px;
          }
          
          .payment-security i {
            color: #10B981;
            margin-right: 5px;
          }
        </style>
      `;
      
      modal.innerHTML = styles + modal.innerHTML;
      return modal;
    }
    
    // ✅ VIEWING PAYMENT SUCCESS
    function showViewingPaymentSuccess(paymentResult, apartmentTitle) {
      const successModal = document.createElement('div');
      successModal.className = 'payment-success-modal';
      successModal.innerHTML = `
        <div class="payment-overlay" onclick="this.parentElement.remove()"></div>
        <div class="payment-success-content">
          <div class="success-icon">
            <i class="fa fa-check-circle"></i>
          </div>
          <h2>Payment Successful!</h2>
          <p>You now have access to <strong>${apartmentTitle}</strong></p>
          <div class="payment-details">
            <p><strong>Payment ID:</strong> ${paymentResult.paymentId || 'N/A'}</p>
            <p><strong>Amount:</strong> €25.00</p>
            <p><strong>Access Valid:</strong> 24 hours</p>
          </div>
          <div class="success-actions">
            <button onclick="window.location.reload()" class="btn-primary">
              <i class="fa fa-eye"></i> View Full Details
            </button>
            <button onclick="this.parentElement.parentElement.remove()" class="btn-secondary">
              <i class="fa fa-times"></i> Close
            </button>
          </div>
        </div>
        <style>
          .payment-success-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10001;
            display: flex;
            align-items: center;
            justify-content: center;
          }
          
          .payment-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
          }
          
          .payment-success-content {
            position: relative;
            background: white;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: successSlideIn 0.5s ease-out;
          }
          
          @keyframes successSlideIn {
            from {
              opacity: 0;
              transform: scale(0.5) rotate(-10deg);
            }
            to {
              opacity: 1;
              transform: scale(1) rotate(0deg);
            }
          }
          
          .success-icon {
            font-size: 80px;
            color: #10B981;
            margin-bottom: 20px;
            animation: successBounce 0.6s ease-out 0.2s both;
          }
          
          @keyframes successBounce {
            0%, 20%, 50%, 80%, 100% {
              transform: translateY(0);
            }
            40% {
              transform: translateY(-30px);
            }
            60% {
              transform: translateY(-15px);
            }
          }
          
          .payment-success-content h2 {
            color: #374151;
            margin: 0 0 15px 0;
            font-size: 28px;
          }
          
          .payment-details {
            background: #F9FAFB;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
          }
          
          .payment-details p {
            margin: 8px 0;
            color: #374151;
          }
          
          .success-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
          }
          
          .success-actions button {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
          }
          
          .btn-primary {
            background: #2563EB;
            color: white;
          }
          
          .btn-primary:hover {
            background: #1D4ED8;
            transform: translateY(-2px);
          }
          
          .btn-secondary {
            background: #F3F4F6;
            color: #374151;
          }
          
          .btn-secondary:hover {
            background: #E5E7EB;
          }
        </style>
      `;
      
      document.body.appendChild(successModal);
      
      // Track successful payment
      trackViewingPayment(paymentResult.apartmentId, paymentResult.paymentId);
    }
    
    // ❌ VIEWING PAYMENT ERROR
    function showViewingPaymentError(error) {
      alert(`Payment failed: ${error.message || 'Unknown error occurred'}. Please try again.`);
    }
    
    // 📊 TRACK VIEWING PAYMENT
    async function trackViewingPayment(apartmentId, paymentId) {
      try {
        console.log('📊 Tracking viewing payment:', { apartmentId, paymentId });
        // Additional analytics tracking can be added here
      } catch (error) {
        console.error('Failed to track viewing payment:', error);
      }
    }
    
    // Update navigation based on login status
    function updateNavigation() {
      const token = localStorage.getItem('userToken');
      const userName = localStorage.getItem('userName');
      const userNavSection = document.getElementById('user-nav-section');
      
      if (token && userName) {
        const userRole = localStorage.getItem('userRole');
        const roleDisplay = userRole === 'admin' ? ' (Admin)' : '';
        userNavSection.innerHTML = `
          <span style="color: var(--primary); font-weight: 600;">Welcome, ${userName}${roleDisplay}!</span>
          <a href="#" onclick="showUserMenu(event)" style="position: relative;">
            <i class="fa fa-user-circle"></i> Menu
          </a>
          <div id="user-menu" style="display: none; position: absolute; right: 0; top: 100%; background: white; box-shadow: var(--shadow); " padding: 10px; min-width: 150px; z-index: 1000;">
            <a href="#" onclick="viewFavorites()" style="display: block; padding: 8px; text-decoration: none; color: var(--text);">
              <i class="fa fa-heart"></i> My Favorites
              <span id="favorites-counter" style="display: none; background: #e74c3c; color: white; padding: 2px 6px; font-size: 11px; margin-left: 8px;"></span>
            </a>
            <a href="#" onclick="viewNotifications()" style="display: block; padding: 8px; text-decoration: none; color: var(--text);">
              <i class="fa fa-bell"></i> Notifications
              <span id="notifications-counter" style="display: none; background: #3498db; color: white; padding: 2px 6px; font-size: 11px; margin-left: 8px;"></span>
            </a>
            <a href="#" onclick="viewRecentlyViewed()" style="display: block; padding: 8px; text-decoration: none; color: var(--text);">
              <i class="fa fa-history"></i> Recently Viewed
            </a>
            <a href="#" onclick="viewProfile()" style="display: block; padding: 8px; text-decoration: none; color: var(--text);">
              <i class="fa fa-user"></i> Profile
            </a>
            <hr style="margin: 8px 0;">
            <a href="#" onclick="logout()" style="display: block; padding: 8px; text-decoration: none; color: var(--danger);">
              <i class="fa fa-sign-out-alt"></i> Logout
            </a>
          </div>
        `;
      } else {
        userNavSection.innerHTML = `
          <a href="login-new.html">Login</a>
          <a href="create-account.html">Create Account</a>
        `;
      }
    }
    
    // Show/hide user menu
    function showUserMenu(event) {
      event.preventDefault();
      const menu = document.getElementById('user-menu');
      menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
      
      // Close menu when clicking outside
      document.addEventListener('click', function closeMenu(e) {
        if (!e.target.closest('#user-menu') && !e.target.closest('[onclick="showUserMenu(event)"]')) {
          menu.style.display = 'none';
          document.removeEventListener('click', closeMenu);
        }
      });
    }
    
    // View user favorites
    function viewFavorites() {
      const token = localStorage.getItem('userToken');
      if (!token) {
        showNotification('Please login to view favorites', 'error');
        return;
      }
      
      // Filter and display only favorited apartments
      const favoriteApartments = apartmentsData.filter(apt => favoriteOffers.has(apt.id));
      
      if (favoriteApartments.length === 0) {
        showNotification('You have no favorite apartments yet!', 'info');
      } else {
        // Scroll to top and highlight favorites
        window.scrollTo(0, 0);
        renderApartments(favoriteApartments);
        showNotification(`Showing ${favoriteApartments.length} favorite apartments`, 'success');
        
        // Add a "Show All" button
        const container = document.getElementById('listings-container');
        const showAllBtn = document.createElement('div');
        showAllBtn.style.cssText = 'text-align: center; margin: 20px 0;';
        showAllBtn.innerHTML = `
          <button onclick="showAllApartments()" style="
            background: var(--primary); 
            color: white; 
            border: none; 
            padding: 12px 24px; 
            " 
            cursor: pointer;
            font-weight: 600;
          ">
            <i class="fa fa-list"></i> Show All Apartments
          </button>
        `;
        container.appendChild(showAllBtn);
      }
      
      document.getElementById('user-menu').style.display = 'none';
    }

    // View user notifications
    async function viewNotifications() {
      const token = localStorage.getItem('userToken');
      if (!token) {
        showNotification('Please login to view notifications', 'error');
        return;
      }
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/notifications?limit=20`, {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          if (data.success) {
            displayNotificationsModal(data.data, data.unreadCount);
          }
        }
      } catch (error) {
        console.error('Failed to load notifications:', error);
        showNotification('Failed to load notifications', 'error');
      }
      
      document.getElementById('user-menu').style.display = 'none';
    }

    // View recently viewed apartments
    async function viewRecentlyViewed() {
      const token = localStorage.getItem('userToken');
      if (!token) {
        showNotification('Please login to view recently viewed apartments', 'error');
        return;
      }
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/recently-viewed?limit=10`, {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          if (data.success) {
            displayRecentlyViewedApartments(data.data);
          }
        }
      } catch (error) {
        console.error('Failed to load recently viewed:', error);
        showNotification('Failed to load recently viewed apartments', 'error');
      }
      
      document.getElementById('user-menu').style.display = 'none';
    }

    // Display notifications modal
    function displayNotificationsModal(notifications, unreadCount) {
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
        background: rgba(0,0,0,0.8); z-index: 1000; display: flex; 
        align-items: center; justify-content: center;
      `;
      
      const content = document.createElement('div');
      content.style.cssText = `
        background: white; border-radius: 12px; width: 90%; max-width: 600px; 
        max-height: 80%; overflow-y: auto; padding: 20px;
      `;
      
      content.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h3>Notifications (${unreadCount} unread)</h3>
          <button onclick="this.closest('.notification-modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
        </div>
        <div>
          ${notifications.length > 0 ? notifications.map(notif => `
            <div style="padding: 12px; border-bottom: 1px solid #eee; ${!notif.read ? 'background: #f8f9fa;' : ''}">
              <h4 style="margin: 0 0 5px 0; font-size: 14px;">${notif.title}</h4>
              <p style="margin: 0 0 5px 0; color: #666; font-size: 13px;">${notif.message}</p>
              <small style="color: #999;">${new Date(notif.created_at).toLocaleDateString()}</small>
            </div>
          `).join('') : '<p>No notifications yet</p>'}
        </div>
      `;
      
      modal.className = 'notification-modal';
      modal.appendChild(content);
      document.body.appendChild(modal);
      
      // Mark notifications as read
      if (unreadCount > 0) {
        markAllNotificationsAsRead();
      }
    }

    // Display recently viewed apartments
    function displayRecentlyViewedApartments(recentApartments) {
      if (recentApartments.length === 0) {
        showNotification('No recently viewed apartments', 'info');
        return;
      }
      
      // Filter and display recently viewed apartments
      const recentApartmentIds = recentApartments.map(item => item.apartment_id);
      const recentData = apartmentsData.filter(apt => recentApartmentIds.includes(apt.id));
      
      if (recentData.length > 0) {
        renderApartments(recentData);
        showNotification(`Showing ${recentData.length} recently viewed apartments`, 'info');
      } else {
        showNotification('Recently viewed apartments are no longer available', 'info');
      }
    }

    // Mark all notifications as read
    async function markAllNotificationsAsRead() {
      const token = localStorage.getItem('userToken');
      if (!token) return;
      
      try {
        await fetch(`${API_BASE_URL}/api/notifications/read-all`, {
          method: 'PUT',
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        
        // Update notification counter
        updateNotificationCounter();
      } catch (error) {
        console.error('Failed to mark notifications as read:', error);
      }
    }

    // Update notification counter
    async function updateNotificationCounter() {
      const token = localStorage.getItem('userToken');
      if (!token) return;
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/notifications?unreadOnly=true&limit=1`, {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          const counter = document.getElementById('notifications-counter');
          if (data.unreadCount > 0) {
            counter.textContent = data.unreadCount;
            counter.style.display = 'inline';
          } else {
            counter.style.display = 'none';
          }
        }
      } catch (error) {
        console.error('Failed to update notification counter:', error);
      }
    }
    
    // Show all apartments again
    function showAllApartments() {
      renderApartments(apartmentsData);
      showNotification('Showing all apartments', 'info');
    }
    
    // View user profile
    function viewProfile() {
      const userName = localStorage.getItem('userName');
      const userEmail = localStorage.getItem('userEmail');
      const userRole = localStorage.getItem('userRole');
      
      alert(`Profile Information:\n\nName: ${userName}\nEmail: ${userEmail}\nRole: ${userRole}\n\nNote: Full profile management coming soon!`);
      document.getElementById('user-menu').style.display = 'none';
    }
    
    // Logout function
    function logout() {
      localStorage.removeItem('userToken');
      localStorage.removeItem('userRole');
      localStorage.removeItem('userId');
      localStorage.removeItem('userName');
      localStorage.removeItem('userEmail');
      
      // Clear favorites
      favoriteOffers.clear();
      
      // Update navigation
      updateNavigation();
      
      // Refresh apartments to remove favorite states
      renderApartments(apartmentsData);
      
      showNotification('Successfully logged out', 'info');
      
      document.getElementById('user-menu').style.display = 'none';
    }
    
    // ================================
    // 🔍 ENHANCED SEARCH AND FILTER SYSTEM
    // ================================
    
    let filteredApartments = [];
    let mapVisible = false;
    
    // Handle search input
    function handleSearch() {
      applyFilters();
    }
    
    // Handle price range filter
    function handlePriceFilter() {
      applyFilters();
    }
    
    // Update price slider display
    function updatePriceSlider() {
      const slider = document.getElementById('price-range');
      const display = document.getElementById('price-display');
      const minPrice = document.getElementById('min-price');
      const maxPrice = document.getElementById('max-price');
      
      const value = parseInt(slider.value);
      display.textContent = `€200 - €${value}`;
      maxPrice.value = value;
      applyFilters();
    }
    
    // Toggle map view functionality
    function toggleMapView() {
      var element = document.getElementById('map-container');
      
      if (element) {
        if (element.style.display === 'none' || element.style.display === '') {
          element.style.display = 'block';
        } else {
          element.style.display = 'none';
        }
      }
    }
    
    // Initialize map (placeholder for Google Maps integration)
    function initializeMap() {
      // This is where Google Maps initialization would go
    }
    
    // ABSOLUTE SIMPLEST POSSIBLE TEST FUNCTION
    function toggleAdvancedSearch() {
      console.log('toggleAdvancedSearch() called');
      var element = document.getElementById('advanced-filters');
      if (element) {
        if (element.style.display === 'none' || element.style.display === '') {
          element.style.display = 'block';
          document.getElementById('advanced-search-text').textContent = 'Hide Advanced';
        } else {
          element.style.display = 'none';
          document.getElementById('advanced-search-text').textContent = 'Advanced Search';
        }
      }
    }
    
    // Expand Map in Container
    function expandMapInContainer() {
      console.log('expandMapInContainer() called');
      // Hide other sections first
      document.getElementById('advanced-filters').style.display = 'none';
      document.getElementById('filters-section').style.display = 'none';
      
      var mapSection = document.getElementById('map-section');
      if (mapSection.style.display === 'none' || mapSection.style.display === '') {
        mapSection.style.display = 'block';
        document.getElementById('map-toggle-text').textContent = 'Hide Map';
      } else {
        mapSection.style.display = 'none';
        document.getElementById('map-toggle-text').textContent = 'Show Map';
      }
    }
    
    // Expand Filters in Container
    function expandFiltersInContainer() {
      console.log('expandFiltersInContainer() called');
      // Hide other sections first
      document.getElementById('advanced-filters').style.display = 'none';
      document.getElementById('map-section').style.display = 'none';
      
      var filtersSection = document.getElementById('filters-section');
      if (filtersSection.style.display === 'none' || filtersSection.style.display === '') {
        filtersSection.style.display = 'block';
      } else {
        filtersSection.style.display = 'none';
      }
    }
    
    // Clear all filters
    function clearAllFilters() {
      // Clear text inputs
      document.getElementById('search-input').value = '';
      document.getElementById('min-price').value = '';
      document.getElementById('max-price').value = '';
      
      // Reset selects
      document.getElementById('bedrooms-filter').value = '';
      document.getElementById('bathrooms-filter').value = '';
      document.getElementById('pet-filter').value = '';
      document.getElementById('furnished-filter').value = '';
      document.getElementById('parking-filter').value = '';
      
      // Reset checkboxes
      const checkboxes = ['amenity-wifi', 'amenity-laundry', 'amenity-ac', 'amenity-balcony', 'amenity-transport', 'amenity-gym', 'amenity-dishwasher', 'amenity-elevator'];
      checkboxes.forEach(id => {
        const checkbox = document.getElementById(id);
        if (checkbox) checkbox.checked = false;
      });
      
      // Reset price slider
      const priceSlider = document.getElementById('price-range');
      const priceDisplay = document.getElementById('price-display');
      priceSlider.value = 1000;
      priceDisplay.textContent = '€200 - €2000';
      
      // Reapply filters
      applyFilters();
    }
    
    // Apply all filters and search
    function applyFilters() {
      const searchTerm = document.getElementById('search-input').value.toLowerCase().trim();
      const minPrice = parseFloat(document.getElementById('min-price').value) || 0;
      const maxPrice = parseFloat(document.getElementById('max-price').value) || Infinity;
      
      // Room filters
      const bedrooms = document.getElementById('bedrooms-filter').value;
      const bathrooms = document.getElementById('bathrooms-filter').value;
      
      // Property filters
      const petPolicy = document.getElementById('pet-filter').value;
      const furnished = document.getElementById('furnished-filter').value;
      const parking = document.getElementById('parking-filter').value;
      
      // Amenity filters
      const needsWifi = document.getElementById('amenity-wifi').checked;
      const needsLaundry = document.getElementById('amenity-laundry').checked;
      const needsAC = document.getElementById('amenity-ac').checked;
      const needsBalcony = document.getElementById('amenity-balcony').checked;
      const needsTransport = document.getElementById('amenity-transport').checked;
      const needsGym = document.getElementById('amenity-gym').checked;
      const needsDishwasher = document.getElementById('amenity-dishwasher').checked;
      const needsElevator = document.getElementById('amenity-elevator').checked;
      
      filteredApartments = apartmentsData.filter(apartment => {
        // Search term filter
        const matchesSearch = !searchTerm || 
          apartment.title.toLowerCase().includes(searchTerm) ||
          apartment.description.toLowerCase().includes(searchTerm) ||
          apartment.location.toLowerCase().includes(searchTerm) ||
          apartment.price.toString().includes(searchTerm);
        
        // Price range filter
        const matchesPrice = apartment.price >= minPrice && apartment.price <= maxPrice;
        
        // Room filters
        const matchesBedrooms = !bedrooms || 
          (bedrooms === '4' ? apartment.bedrooms >= 4 : apartment.bedrooms == bedrooms);
        const matchesBathrooms = !bathrooms || 
          (bathrooms === '3' ? apartment.bathrooms >= 3 : apartment.bathrooms == bathrooms);
        
        // Property filters
        const matchesPets = !petPolicy || apartment.petPolicy === petPolicy;
        const matchesFurnished = !furnished || apartment.furnished === furnished;
        const matchesParking = !parking || apartment.parking === parking;
        
        // Amenity filters
        const matchesAmenities = 
          (!needsWifi || apartment.amenities?.includes('wifi')) &&
          (!needsLaundry || apartment.amenities?.includes('laundry')) &&
          (!needsAC || apartment.amenities?.includes('ac')) &&
          (!needsBalcony || apartment.amenities?.includes('balcony')) &&
          (!needsTransport || apartment.amenities?.includes('transport')) &&
          (!needsGym || apartment.amenities?.includes('gym')) &&
          (!needsDishwasher || apartment.amenities?.includes('dishwasher')) &&
          (!needsElevator || apartment.amenities?.includes('elevator'));
        
        return matchesSearch && matchesPrice && matchesBedrooms && matchesBathrooms && 
               matchesPets && matchesFurnished && matchesParking && matchesAmenities;
      });
      
      // Update display
      renderApartments(filteredApartments);
      updateFilterSummary(filteredApartments.length, apartmentsData.length);
    }
    
    // Update filter summary
    function updateFilterSummary(filtered, total) {
      const summary = document.getElementById('filter-summary');
      const activeFilters = [];
      
      // Check active filters
      const searchTerm = document.getElementById('search-input').value.trim();
      const minPrice = document.getElementById('min-price').value;
      const maxPrice = document.getElementById('max-price').value;
      const bedrooms = document.getElementById('bedrooms-filter').value;
      const bathrooms = document.getElementById('bathrooms-filter').value;
      const petPolicy = document.getElementById('pet-filter').value;
      const furnished = document.getElementById('furnished-filter').value;
      const parking = document.getElementById('parking-filter').value;
      
      // Count checked amenities
      const checkedAmenities = ['amenity-wifi', 'amenity-laundry', 'amenity-ac', 'amenity-balcony', 'amenity-transport', 'amenity-gym', 'amenity-dishwasher', 'amenity-elevator']
        .filter(id => document.getElementById(id).checked).length;
      
      // Build summary
      if (searchTerm) activeFilters.push(`Search: "${searchTerm}"`);
      if (minPrice || maxPrice) activeFilters.push(`Price: €${minPrice || '0'} - €${maxPrice || '∞'}`);
      if (bedrooms) activeFilters.push(`${bedrooms}${bedrooms === '4' ? '+' : ''} bedrooms`);
      if (bathrooms) activeFilters.push(`${bathrooms}${bathrooms === '3' ? '+' : ''} bathrooms`);
      if (petPolicy) activeFilters.push(`${petPolicy.replace('-', ' ')}`);
      if (furnished) activeFilters.push(furnished);
      if (parking) activeFilters.push(`${parking} parking`);
      if (checkedAmenities > 0) activeFilters.push(`${checkedAmenities} amenity filter${checkedAmenities > 1 ? 's' : ''}`);
      
      // Display summary
      if (filtered === total) {
        summary.innerHTML = `<i class="fas fa-home"></i> Showing all ${total} apartments`;
      } else {
        summary.innerHTML = `<i class="fas fa-filter"></i> Showing ${filtered} of ${total} apartments`;
        if (activeFilters.length > 0) {
          summary.innerHTML += `<br><small style="color: var(--primary); font-weight: 500; margin-top: 4px; display: block;">
            Active filters: ${activeFilters.join(', ')}
          </small>`;
        }
      }
    }
    
    // Update results summary (keeping old function for compatibility)
    function updateResultsSummary(filtered, total) {
      updateFilterSummary(filtered, total);
    }
    
    // Apply modal filters (B12 Spec Compliant)
    function applyModalFilters() {
      const filters = {
        // Location
        city: document.getElementById('city-filter')?.value.trim() || '',
        
        // Time
        moveIn: document.getElementById('move-in-date')?.value || '',
        moveOut: document.getElementById('move-out-date')?.value || '',
        earliestMoveIn: document.getElementById('earliest-move-in')?.checked || false,
        timeFlexibility: document.querySelector('input[name="time-flexibility"]:checked')?.value || 'flexible',
        
        // Price
        priceTypes: {
          kalt: document.getElementById('price-type-kalt')?.checked || false,
          warm: document.getElementById('price-type-warm')?.checked || false
        },
        minPrice: parseFloat(document.getElementById('min-price')?.value) || 0,
        maxPrice: parseFloat(document.getElementById('max-price')?.value) || Infinity,
        
        // Property Types (multi-select checkboxes)
        propertyTypes: Array.from(document.querySelectorAll('input[name="property-type"]:checked'))
          .map(cb => cb.value),
        
        // Rooms & Beds
        roomsCount: document.getElementById('rooms-count')?.value || '',
        singleBeds: document.getElementById('single-beds')?.value || '',
        doubleBeds: document.getElementById('double-beds')?.value || '',
        
        // Furnished
        furnished: document.getElementById('furnished-filter')?.value || '',
        
        // Amenities (multi-select checkboxes)
        amenities: Array.from(document.querySelectorAll('input[name="amenity"]:checked'))
          .map(cb => cb.value),
        
        // More filters
        excludeExchange: document.getElementById('exclude-exchange')?.checked || false,
        petsPolicy: document.querySelector('input[name="pets-policy"]:checked')?.value || 'any'
      };
      
      console.log('Applying filters:', filters);
      
      // Filter apartments
      filteredApartments = apartmentsData.filter(apartment => {
        // City filter
        const matchesCity = !filters.city || 
          apartment.location?.toLowerCase().includes(filters.city.toLowerCase());
        
        // Time filters
        const matchesMoveIn = !filters.moveIn || 
          !apartment.available_from || 
          new Date(apartment.available_from) <= new Date(filters.moveIn);
        
        const matchesMoveOut = !filters.moveOut || 
          !apartment.available_until || 
          new Date(apartment.available_until) >= new Date(filters.moveOut);
        
        // Price type filter
        let matchesPriceType = true;
        if (filters.priceTypes.kalt && !filters.priceTypes.warm) {
          matchesPriceType = apartment.price_type === 'kalt';
        } else if (!filters.priceTypes.kalt && filters.priceTypes.warm) {
          matchesPriceType = apartment.price_type === 'warm';
        }
        // If both or neither checked, show all
        
        // Price range filter
        const matchesPrice = apartment.price >= filters.minPrice && 
                             apartment.price <= filters.maxPrice;
        
        // Property type filter (multi-select OR logic)
        const matchesPropertyType = filters.propertyTypes.length === 0 || 
          filters.propertyTypes.includes(apartment.property_type);
        
        // Rooms & Beds filters
        const matchesRooms = !filters.roomsCount || 
          (filters.roomsCount === '4' ? apartment.rooms >= 4 : apartment.rooms == filters.roomsCount);
        
        const matchesSingleBeds = !filters.singleBeds || 
          (filters.singleBeds === '3' ? apartment.single_beds >= 3 : apartment.single_beds == filters.singleBeds);
        
        const matchesDoubleBeds = !filters.doubleBeds || 
          (filters.doubleBeds === '3' ? apartment.double_beds >= 3 : apartment.double_beds == filters.doubleBeds);
        
        // Furnished filter
        const matchesFurnished = !filters.furnished || apartment.furnished === filters.furnished;
        
        // Amenities filter (AND logic - all selected must be present)
        const matchesAmenities = filters.amenities.length === 0 || 
          filters.amenities.every(amenity => apartment.amenities?.includes(amenity));
        
        // Exchange filter
        const matchesExchange = !filters.excludeExchange || apartment.is_exchange !== true;
        
        // Pets filter
        const matchesPets = filters.petsPolicy === 'any' || 
          (filters.petsPolicy === 'allowed' && apartment.pets_allowed === true) ||
          (filters.petsPolicy === 'not_allowed' && apartment.pets_allowed === false);
        
        return matchesCity && matchesMoveIn && matchesMoveOut && matchesPriceType && 
               matchesPrice && matchesPropertyType && matchesRooms && 
               matchesSingleBeds && matchesDoubleBeds && matchesFurnished && 
               matchesAmenities && matchesExchange && matchesPets;
      });
      
      // Sort by earliest move-in if checked
      if (filters.earliestMoveIn) {
        filteredApartments.sort((a, b) => {
          const dateA = new Date(a.available_from || '9999-12-31');
          const dateB = new Date(b.available_from || '9999-12-31');
          return dateA - dateB;
        });
      }
      
      // Update display
      renderApartments(filteredApartments);
      updateFilterSummary(filteredApartments.length, apartmentsData.length);
      
      // Close modal
      document.getElementById('filters-container').classList.remove('active');
      
      showNotification(`Applied filters - showing ${filteredApartments.length} of ${apartmentsData.length} apartments`, 'success');
    }
    
    // Clear all filters (B12 Spec Compliant)
    function clearAllFilters() {
      // City
      if (document.getElementById('city-filter')) 
        document.getElementById('city-filter').value = '';
      
      // Time filters
      if (document.getElementById('move-in-date')) 
        document.getElementById('move-in-date').value = '';
      if (document.getElementById('move-out-date')) 
        document.getElementById('move-out-date').value = '';
      if (document.getElementById('earliest-move-in')) 
        document.getElementById('earliest-move-in').checked = false;
      
      // Reset time flexibility to flexible (default)
      const flexibleRadio = document.querySelector('input[name="time-flexibility"][value="flexible"]');
      if (flexibleRadio) flexibleRadio.checked = true;
      
      // Price filters
      if (document.getElementById('price-type-kalt')) 
        document.getElementById('price-type-kalt').checked = true;
      if (document.getElementById('price-type-warm')) 
        document.getElementById('price-type-warm').checked = true;
      if (document.getElementById('min-price')) 
        document.getElementById('min-price').value = '';
      if (document.getElementById('max-price')) 
        document.getElementById('max-price').value = '';
      if (document.getElementById('price-range')) {
        document.getElementById('price-range').value = 1000;
        updatePriceSlider();
      }
      
      // Property type checkboxes
      document.querySelectorAll('input[name="property-type"]').forEach(cb => cb.checked = false);
      
      // Rooms & Beds
      if (document.getElementById('rooms-count')) 
        document.getElementById('rooms-count').value = '';
      if (document.getElementById('single-beds')) 
        document.getElementById('single-beds').value = '';
      if (document.getElementById('double-beds')) 
        document.getElementById('double-beds').value = '';
      
      // Furnished
      if (document.getElementById('furnished-filter')) 
        document.getElementById('furnished-filter').value = '';
      
      // Amenities checkboxes
      document.querySelectorAll('input[name="amenity"]').forEach(cb => cb.checked = false);
      
      // More filters
      if (document.getElementById('exclude-exchange')) 
        document.getElementById('exclude-exchange').checked = false;
      
      // Reset pets policy to 'any' (default)
      const anyPetsRadio = document.querySelector('input[name="pets-policy"][value="any"]');
      if (anyPetsRadio) anyPetsRadio.checked = true;
      
      // Also clear quick search input (if exists)
      if (document.getElementById('search-input')) 
        document.getElementById('search-input').value = '';
      
      // Reset old filter fields (backward compatibility)
      if (document.getElementById('bedrooms-filter')) 
        document.getElementById('bedrooms-filter').value = '';
      if (document.getElementById('bathrooms-filter')) 
        document.getElementById('bathrooms-filter').value = '';
      if (document.getElementById('pet-filter')) 
        document.getElementById('pet-filter').value = '';
      
      // Clear old amenity checkboxes (if they still exist)
      ['amenity-wifi', 'amenity-laundry', 'amenity-ac', 'amenity-balcony', 
       'amenity-transport', 'amenity-gym', 'amenity-dishwasher', 'amenity-elevator'].forEach(id => {
        const elem = document.getElementById(id);
        if (elem) elem.checked = false;
      });
      
      // Reset filtered list and render all
      filteredApartments = [...apartmentsData];
      renderApartments(filteredApartments);
      updateFilterSummary(filteredApartments.length, apartmentsData.length);
      
      showNotification('All filters cleared', 'info');
    }
    
    // Update results summary for modal filters
    function updateModalResultsSummary() {
      const summary = document.getElementById('results-summary');
      const total = apartmentsData.length;
      const filtered = filteredApartments.length;
      
      if (filtered === total) {
        summary.innerHTML = `<i class="fa fa-home"></i> Showing all ${total} apartments`;
      } else {
        summary.innerHTML = `<i class="fa fa-filter"></i> Showing ${filtered} of ${total} apartments`;
      }
      
      // Add active filter indicators
      const activeFilters = [];
      
      // Quick filters
      const searchTerm = document.getElementById('search-input').value.trim();
      const minPrice = document.getElementById('min-price').value;
      const maxPrice = document.getElementById('max-price').value;
      const bedrooms = document.getElementById('bedrooms-filter').value;
      
      // Modal filters
      const city = document.getElementById('city').value.trim();
      const moveIn = document.getElementById('move-in').value;
      const moveOut = document.getElementById('move-out').value;
      const modalPrice = document.getElementById('price').value;
      const propertyType = document.getElementById('property-type').value;
      const amenities = document.getElementById('amenities').selectedOptions;
      const bedTypes = document.getElementById('bed-type').selectedOptions;
      const rooms = document.getElementById('rooms').value;
      
      if (searchTerm) activeFilters.push(`Search: "${searchTerm}"`);
      if (minPrice || maxPrice) activeFilters.push(`Quick Price: ${minPrice || '0'}-${maxPrice || '∞'}€`);
      if (bedrooms) activeFilters.push(`${bedrooms}+ bedrooms`);
      if (city) activeFilters.push(`City: "${city}"`);
      if (moveIn) activeFilters.push(`Move-in: ${moveIn}`);
      if (moveOut) activeFilters.push(`Move-out: ${moveOut}`);
      if (modalPrice) activeFilters.push(`Max Price: €${modalPrice}`);
      if (propertyType) activeFilters.push(`Type: ${propertyType.replace('-', ' ')}`);
      if (amenities.length > 0) activeFilters.push(`${amenities.length} amenities`);
      if (bedTypes.length > 0) activeFilters.push(`${bedTypes.length} bed types`);
      if (rooms) activeFilters.push(`${rooms}+ rooms`);
      
      if (activeFilters.length > 0) {
        summary.innerHTML += `<br><small style="color: var(--primary); font-weight: 600;">Active filters: ${activeFilters.join(', ')}</small>`;
      }
    }
    
    // Clear all filters
    function clearFilters() {
      // Quick filter fields
      document.getElementById('search-input').value = '';
      document.getElementById('min-price').value = '';
      document.getElementById('max-price').value = '';
      document.getElementById('bedrooms-filter').value = '';
      
      // Modal filter fields
      document.getElementById('city').value = '';
      document.getElementById('move-in').value = '';
      document.getElementById('move-out').value = '';
      document.getElementById('price').value = '';
      document.getElementById('property-type').value = '';
      document.getElementById('rooms').value = '';
      
      // Clear multiple select fields
      const amenitiesSelect = document.getElementById('amenities');
      for (let i = 0; i < amenitiesSelect.options.length; i++) {
        amenitiesSelect.options[i].selected = false;
      }
      
      const bedTypesSelect = document.getElementById('bed-type');
      for (let i = 0; i < bedTypesSelect.options.length; i++) {
        bedTypesSelect.options[i].selected = false;
      }
      
      renderApartments(apartmentsData);
      updateResultsSummary(apartmentsData.length, apartmentsData.length);
      
      showNotification('All filters cleared', 'info');
    }
    
    // Enhanced apartment rendering with search highlighting
    function renderApartments(apartments) {
      const container = document.getElementById('listings-container');
      const searchTerm = document.getElementById('search-input')?.value.toLowerCase().trim() || '';
      
      if (!apartments || apartments.length === 0) {
        container.innerHTML = `
          <div style="text-align: center; padding: 40px; color: var(--text);">
            <i class="fa fa-search" style="font-size: 3rem; color: #ccc; margin-bottom: 16px;"></i>
            <h3>No apartments found</h3>
            <p>Try adjusting your search criteria or clearing filters</p>
            <button onclick="clearFilters()" style="margin-top: 16px; background: var(--primary); color: white; border: none; padding: 12px 24px; " cursor: pointer;">
              Clear All Filters
            </button>
          </div>
        `;
        return;
      }
      
      container.innerHTML = apartments.map(apartment => {
        const isLoggedIn = !!localStorage.getItem('userToken');
        const isFavorite = favoriteOffers.has(apartment.id);
        
        // Highlight search terms
        let highlightedTitle = apartment.title;
        let highlightedDescription = apartment.description;
        if (searchTerm) {
          const regex = new RegExp(`(${searchTerm})`, 'gi');
          highlightedTitle = apartment.title.replace(regex, '<mark style="background: #fff3cd; padding: 1px 3px; "">$1</mark>');
          highlightedDescription = apartment.description.replace(regex, '<mark style="background: #fff3cd; padding: 1px 3px; "">$1</mark>');
        }
        
        return `
          <div class="listing-card" style="position: relative;">
            ${isLoggedIn ? `
              <button class="favorite-button" onclick="toggleFavorite('${apartment.id}', event)" style="
                position: absolute;
                top: 12px;
                right: 12px;
                background: ${isFavorite ? '#e74c3c' : 'rgba(255,255,255,0.9)'};
                color: ${isFavorite ? 'white' : '#666'};
                border: none;
                width: 40px;
                height: 40px;
                "
                cursor: pointer;
                box-shadow: 0 2px 8px rgba(0,0,0,0.15);
                transition: all 0.2s;
                z-index: 10;
              ">
                <i class="fa ${isFavorite ? 'fa-heart' : 'fa-heart-o'}" style="font-size: 16px;"></i>
              </button>
            ` : ''}
            
            <img src="${apartment.images}" alt="${apartment.title}">
            <div class="listing-details">
              <div class="listing-title">${highlightedTitle}</div>
              <div class="listing-location">📍 ${apartment.location}</div>
              <div class="listing-price">€${apartment.price}/month</div>
              <div class="listing-features">
                <span><i class="fa fa-bed"></i> ${apartment.bedrooms} bed${apartment.bedrooms !== 1 ? 's' : ''}</span>
                <span><i class="fa fa-bath"></i> ${apartment.bathrooms} bath${apartment.bathrooms !== 1 ? 's' : ''}</span>
                <span><i class="fa fa-expand-arrows-alt"></i> ${apartment.size}m²</span>
              </div>
              <div class="listing-description">${highlightedDescription}</div>
              
              <div class="listing-actions">
                <button onclick="initiateViewingPayment('${apartment.id}', '${apartment.title || apartment.address}')" class="btn-primary">
                  <i class="fa fa-credit-card"></i> Pay €25 to View
                </button>
                <button onclick="contactLandlord('${apartment.id}')" class="btn-secondary">
                  <i class="fa fa-envelope"></i> Contact
                </button>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }
    
    // Unified Display Functions for Map and Advanced Search
    function showMapView() {
      const container = document.getElementById('display-container');
      const mapContent = document.getElementById('map-view-content');
      const searchContent = document.getElementById('advanced-search-content');
      
      // Show map content, hide search content
      mapContent.style.display = 'block';
      searchContent.style.display = 'none';
      
      // Show container with smooth animation
      container.style.display = 'block';
      setTimeout(() => {
        container.style.maxHeight = '500px';
      }, 10);
    }
    
    function showAdvancedSearch() {
      const container = document.getElementById('display-container');
      const mapContent = document.getElementById('map-view-content');
      const searchContent = document.getElementById('advanced-search-content');
      
      // Show search content, hide map content
      searchContent.style.display = 'block';
      mapContent.style.display = 'none';
      
      // Show container with smooth animation
      container.style.display = 'block';
      setTimeout(() => {
        container.style.maxHeight = '600px';
      }, 10);
    }
    
    function hideDisplayContainer() {
      const container = document.getElementById('display-container');
      
      // Animate out
      container.style.maxHeight = '0';
      setTimeout(() => {
        container.style.display = 'none';
      }, 300);
    }
    
    function applyAdvancedFilters() {
      // Collect values from advanced search form
      console.log('Advanced filters applied');
      hideDisplayContainer();
      // Add your filter logic here
    }
    
    function clearAdvancedFilters() {
      // Clear all advanced search form values
      const selects = document.querySelectorAll('#advanced-search-content select');
      const checkboxes = document.querySelectorAll('#advanced-search-content input[type="checkbox"]');
      const inputs = document.querySelectorAll('#advanced-search-content input[type="number"]');
      
      selects.forEach(select => select.value = '');
      checkboxes.forEach(checkbox => checkbox.checked = false);
      inputs.forEach(input => input.value = '');
      
      console.log('Advanced filters cleared');
    }

  </script>

  <!-- SichrPlace Footer -->
  <footer style="margin-top: 40px; padding: 20px 0; border-top: 1px solid #E5E7EB; background: var(--secondary);">
      <div class="footer-brand" style="text-align: center; margin: 20px 0;">

        <div class="footer-brand-text" style="color: #6B7280; font-size: 14px;">
              Your Trusted Rental Platform
          </div>
      </div>
      <div class="footer-links" style="text-align: center; margin: 15px 0;">
          <a href="privacy-policy.html" style="color: #6B7280; text-decoration: none; margin: 0 15px; font-size: 14px;">Privacy Policy</a>
          <a href="terms-of-service.html" style="color: #6B7280; text-decoration: none; margin: 0 15px; font-size: 14px;">Terms of Service</a>
          <a href="index.html" style="color: #6B7280; text-decoration: none; margin: 0 15px; font-size: 14px;">Home</a>
      </div>
      <p style="text-align: center; color: #9CA3AF; font-size: 12px; margin: 10px 0 0 0;">&copy; 2025 SichrPlace. All rights reserved.</p>
  </footer>
</body>
</html>